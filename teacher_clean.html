<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eden Family School - Portail Enseignants & Parents</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Dropzone pour upload d'images -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css">
    
    <!-- Quill Editor pour éditeur de texte -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    
    <!-- FullCalendar pour calendrier -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    
    <!-- Chart.js pour graphiques -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SheetJS pour Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2ecc71;
            --secondary-dark: #27ae60;
            --accent: #e74c3c;
            --warning: #f39c12;
            --warning-dark: #d35400;
            --info: #9b59b6;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --light-gray: #ecf0f1;
            --border-radius: 12px;
            --box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --box-shadow-hover: 0 15px 35px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, #2980b9 100%);
            --gradient-secondary: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-attachment: fixed;
            color: var(--dark);
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* Header amélioré */
        .modern-header {
            background: var(--gradient-primary);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            background: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }
        
        .logo:hover .logo-icon {
            transform: rotate(15deg);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.4);
        }
        
        .logo-text h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.6rem;
            margin: 0;
            color: white;
        }
        
        .logo-text p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 18px;
            color: var(--primary);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.4);
            transition: var(--transition);
            cursor: pointer;
        }
        
        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.5);
        }
        
        /* Navigation améliorée */
        .main-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 80px;
            z-index: 999;
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-tabs {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .nav-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--gray);
            font-weight: 500;
            border-radius: 8px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
            position: relative;
        }
        
        .nav-btn:hover {
            background: rgba(52, 152, 219, 0.1);
            color: var(--primary);
            transform: translateY(-2px);
        }
        
        .nav-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .nav-btn .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 0.7rem;
            padding: 3px 6px;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
        }
        
        .quick-action-btn {
            padding: 8px 15px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .quick-action-btn:hover {
            background: var(--secondary-dark);
            transform: translateY(-2px);
        }
        
        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .section.active {
            display: block;
        }
        
        /* Cards améliorées */
        .dashboard-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            margin-bottom: 1.5rem;
            transition: var(--transition);
            border: 1px solid #eef2ff;
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transition: var(--transition);
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-hover);
        }
        
        .dashboard-card:hover::before {
            width: 6px;
            background: var(--primary-dark);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #f1f1f1;
        }
        
        .card-title {
            font-weight: 600;
            color: var(--dark);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: var(--primary);
        }
        
        /* Statistics Cards */
        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border-left: 4px solid var(--primary);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow-hover);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 24px;
            color: white;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin: 0.5rem 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Progress Bars */
        .progress-container {
            margin: 1rem 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .progress-bar-modern {
            height: 10px;
            background: var(--light-gray);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 5px;
            transition: width 1s ease-in-out;
        }
        
        /* Forms améliorés */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .form-control-modern {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px 16px;
            transition: var(--transition);
            width: 100%;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
        }
        
        .form-control-modern:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            outline: none;
        }
        
        /* Buttons améliorés */
        .btn-modern {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-modern::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn-modern:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        .btn-primary-modern {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary-modern:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-success-modern {
            background: var(--secondary);
            color: white;
        }
        
        .btn-success-modern:hover {
            background: var(--secondary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
        }
        
        /* Badges modernes */
        .badge-modern {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .badge-primary {
            background: rgba(52, 152, 219, 0.1);
            color: var(--primary);
        }
        
        .badge-success {
            background: rgba(46, 204, 113, 0.1);
            color: var(--secondary);
        }
        
        .badge-warning {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }
        
        /* Tableaux améliorés */
        .table-modern {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }
        
        .table-modern thead {
            background: var(--light-gray);
        }
        
        .table-modern th {
            border: none;
            padding: 15px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .table-modern td {
            padding: 15px;
            border-top: 1px solid #eee;
            vertical-align: middle;
        }
        
        .table-modern tr:hover {
            background: rgba(52, 152, 219, 0.03);
        }
        
        /* Alertes modernes */
        .alert-modern {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            border: none;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 1rem;
        }
        
        .alert-info {
            background: rgba(52, 152, 219, 0.1);
            color: var(--primary);
            border-left: 4px solid var(--primary);
        }
        
        .alert-success {
            background: rgba(46, 204, 113, 0.1);
            color: var(--secondary);
            border-left: 4px solid var(--secondary);
        }
        
        .alert-warning {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
            border-left: 4px solid var(--warning);
        }
        
        /* Gallery améliorée */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .gallery-item {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            aspect-ratio: 1;
            cursor: pointer;
        }
        
        .gallery-item:hover {
            transform: scale(1.03);
            box-shadow: var(--box-shadow-hover);
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .gallery-item-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 1rem;
            transform: translateY(100%);
            transition: var(--transition);
        }
        
        .gallery-item:hover .gallery-item-overlay {
            transform: translateY(0);
        }
        
        /* Modal amélioré */
        .modal-modern .modal-content {
            border-radius: var(--border-radius);
            border: none;
            box-shadow: var(--box-shadow-hover);
        }
        
        .modal-modern .modal-header {
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            padding: 1.5rem;
        }
        
        .modal-modern .modal-body {
            padding: 1.5rem;
        }
        
        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--light-gray);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid white;
            box-shadow: 0 0 0 3px var(--light-gray);
        }
        
        .timeline-date {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .timeline-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: var(--box-shadow);
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        /* Notifications */
        .notification-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            gap: 15px;
            align-items: flex-start;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .notification-item:hover {
            background: rgba(52, 152, 219, 0.05);
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-time {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }
        
        /* Search Bar */
        .search-bar {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 0.95rem;
            transition: var(--transition);
            background: white;
        }
        
        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            outline: none;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        
        /* Sidebar (pour version desktop étendue) */
        .sidebar {
            width: 250px;
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 100px;
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 0;
        }
        
        .sidebar-menu li {
            margin-bottom: 10px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            color: var(--dark);
            text-decoration: none;
            border-radius: 8px;
            transition: var(--transition);
        }
        
        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(52, 152, 219, 0.1);
            color: var(--primary);
        }
        
        /* Animations améliorées */
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(52, 152, 219, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0);
            }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        /* Responsive amélioré */
        @media (max-width: 1200px) {
            .header-container, .nav-container, .main-content {
                padding: 0 1.5rem;
            }
        }
        
        @media (max-width: 992px) {
            .nav-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-tabs {
                width: 100%;
                justify-content: center;
            }
            
            .quick-actions {
                width: 100%;
                justify-content: center;
            }

            body {
                font-size: 14px;
            }

            input, select, textarea, button {
                font-size: 14px;
            }
        }
        
        @media (max-width: 768px) {
            .header-container, .nav-container, .main-content {
                padding: 0 1rem;
            }
            
            .logo-text h1 {
                font-size: 1.3rem;
            }
            
            .nav-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }

            body {
                font-size: 13px;
            }

            input, select, textarea {
                font-size: 15px;
            }
        }

        /* Téléphones petits (320px - 480px) */
        @media (max-width: 480px) {
            body {
                font-size: 12px;
                overflow-x: hidden;
            }

            .header-container {
                padding: 0 0.5rem;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .nav-container, .main-content {
                padding: 0 0.5rem;
            }

            .logo-text h1 {
                font-size: 1.1rem;
            }

            .user-info {
                gap: 8px;
            }

            .user-text {
                display: none;
            }

            .user-avatar {
                width: 35px;
                height: 35px;
                font-size: 0.8rem;
            }

            .nav-btn {
                padding: 8px 10px;
                font-size: 0.8rem;
                margin: 2px;
            }

            .nav-tabs {
                gap: 2px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .quick-actions {
                flex-direction: column;
                width: 100%;
                gap: 0.5rem;
            }

            .quick-action-btn {
                width: 100%;
                padding: 0.6rem;
                font-size: 0.85rem;
                border-radius: 6px;
            }

            .quick-action-btn span {
                display: inline;
            }

            h1, h2 {
                font-size: 1.2rem;
            }

            h3, h4, h5, h6 {
                font-size: 0.95rem;
            }

            .form-label {
                font-size: 0.85rem;
                margin-bottom: 0.2rem;
            }

            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="date"],
            input[type="number"],
            select,
            textarea {
                font-size: 16px;
                padding: 0.6rem;
                width: 100%;
                border-radius: 6px;
            }

            button, .btn {
                padding: 0.6rem;
                font-size: 0.9rem;
                width: 100%;
                border-radius: 6px;
            }

            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 0.75rem;
            }

            .stat-card {
                padding: 0.75rem;
                margin-bottom: 0.75rem;
                border-radius: 8px;
            }

            .stat-value {
                font-size: 1.2rem;
            }

            .stat-label {
                font-size: 0.8rem;
            }

            .d-flex {
                flex-direction: column;
                gap: 0.5rem;
            }

            .row {
                margin: 0;
                gap: 0;
            }

            [class*="col-"] {
                padding: 0.25rem;
                margin-bottom: 0.5rem;
            }

            table {
                font-size: 0.75rem;
            }

            table th, table td {
                padding: 0.35rem;
            }

            .modal-dialog {
                margin: 0.5rem;
                width: 95%;
            }

            .modal-content {
                border-radius: 10px;
            }

            .modal-body {
                padding: 1rem 0.75rem;
            }

            .dashboard-card {
                padding: 0.75rem;
                margin-bottom: 1rem;
                border-radius: 8px;
            }

            .table-responsive {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .badge {
                font-size: 0.65rem;
                padding: 0.25em 0.4em;
            }

            .alert {
                padding: 0.75rem;
                font-size: 0.85rem;
                border-radius: 6px;
            }

            .icon-large {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 576px) {
            .user-info {
                gap: 10px;
            }
            
            .user-text {
                display: none;
            }
            
            .quick-action-btn span {
                display: none;
            }
            
            .quick-action-btn {
                padding: 8px;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                justify-content: center;
            }
        }

        /* Tablettes (481px - 768px) */
        @media (min-width: 481px) and (max-width: 768px) {
            body {
                font-size: 13px;
            }

            .header-container {
                flex-wrap: wrap;
            }

            .nav-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            .stat-card {
                padding: 1rem;
            }

            input, select, textarea, button {
                font-size: 14px;
            }

            table {
                font-size: 0.85rem;
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                color: #e0e0e0;
            }
            
            .dashboard-card,
            .stat-card,
            .table-modern {
                background: #2c3e50;
                color: #e0e0e0;
                border-color: #34495e;
            }
            
            .table-modern th {
                background: #34495e;
                color: #e0e0e0;
            }
            
            .search-input {
                background: #34495e;
                border-color: #4a6572;
                color: #e0e0e0;
            }
            
            .form-control-modern {
                background: #34495e;
                border-color: #4a6572;
                color: #e0e0e0;
            }
            
            .form-control-modern:focus {
                background: #2c3e50;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="modern-header">
        <div class="header-container">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-school"></i>
                </div>
                <div class="logo-text">
                    <h1>Eden Family School</h1>
                    <p>Portail Enseignants & Parents</p>
                </div>
            </div>
            
            <div class="user-info">
                <div class="text-end text-white d-none d-md-block">
                    <div class="fw-bold" id="userName">Chargement...</div>
                    <small id="userRole" style="opacity: 0.9;">Enseignant</small>
                </div>
                <div class="user-avatar" id="userAvatar" onclick="toggleUserMenu()">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="nav-tabs">
                <button class="nav-btn active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Tableau de bord</span>
                </button>
                <button class="nav-btn" onclick="showSection('students')">
                    <i class="fas fa-users"></i>
                    <span>Mes élèves</span>
                </button>
                <button class="nav-btn" onclick="showSection('grades')">
                    <i class="fas fa-chart-line"></i>
                    <span>Notes & Évaluations</span>
                </button>
                <button class="nav-btn" onclick="showSection('attendance')">
                    <i class="fas fa-calendar-check"></i>
                    <span>Présence</span>
                </button>
                <button class="nav-btn" onclick="showSection('gallery')">
                    <i class="fas fa-images"></i>
                    <span>Galerie</span>
                </button>
                <button class="nav-btn" onclick="showSection('activities')">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Activités</span>
                </button>
                <button class="nav-btn" onclick="showSection('calendar')">
                    <i class="fas fa-calendar-day"></i>
                    <span>Calendrier</span>
                </button>
                <button class="nav-btn" onclick="showSection('library')">
                    <i class="fas fa-book"></i>
                    <span>Bibliothèque</span>
                </button>
                <button class="nav-btn" onclick="showSection('youtube')">
                    <i class="fab fa-youtube"></i>
                    <span>Vidéos</span>
                </button>
                <button class="nav-btn" onclick="showSection('messages')">
                    <i class="fas fa-envelope"></i>
                    <span>Messagerie</span>
                    <span class="badge bg-danger" id="messageCount" style="display: none;">0</span>
                </button>
            </div>
            
            <div class="quick-actions">
                <button class="quick-action-btn" onclick="showAddGradeModal()">
                    <i class="fas fa-plus"></i>
                    <span>Ajouter Note</span>
                </button>
                <button class="quick-action-btn" style="background: var(--warning);" onclick="showAddActivityModal()">
                    <i class="fas fa-calendar-plus"></i>
                    <span>Nouvelle Activité</span>
                </button>
                <button class="quick-action-btn" style="background: var(--info);" onclick="showUploadModal()">
                    <i class="fas fa-upload"></i>
                    <span>Télécharger</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- User Menu Dropdown -->
    <div id="userMenu" class="dashboard-card" style="display: none; position: fixed; top: 80px; right: 20px; width: 250px; z-index: 1001;">
        <div class="text-center mb-3">
            <div class="user-avatar mx-auto" style="width: 80px; height: 80px; font-size: 24px;" id="menuUserAvatar"></div>
            <h6 class="mt-2" id="menuUserName"></h6>
            <small class="text-muted" id="menuUserRole"></small>
        </div>
        <hr>
        <div class="d-grid gap-2">
            <button class="btn-modern" onclick="showSection('profile')">
                <i class="fas fa-user-circle"></i>
                <span>Mon Profil</span>
            </button>
            <button class="btn-modern" onclick="showSettings()">
                <i class="fas fa-cog"></i>
                <span>Paramètres</span>
            </button>
            <button class="btn-modern" onclick="showHelp()">
                <i class="fas fa-question-circle"></i>
                <span>Aide & Support</span>
            </button>
            <button class="btn-modern" style="background: #e74c3c; color: white;" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="dashboard-card">
                <h2 class="fw-bold mb-3">Bienvenue sur le portail Eden Family School</h2>
                <p class="text-muted mb-4">Gérez vos classes, activités et communiquez avec les parents</p>
                
                <!-- Search Bar -->
                <div class="search-bar">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Rechercher des élèves, activités, documents..." id="globalSearch">
                </div>
                
                <!-- Statistics Cards -->
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--primary);">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3 class="stat-value" id="myStudentsCount">0</h3>
                            <p class="stat-label">Élèves assignés</p>
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>Actifs</span>
                                    <span id="activeStudentsPercent">0%</span>
                                </div>
                                <div class="progress-bar-modern">
                                    <div class="progress-fill" id="activeStudentsBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--secondary);">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <h3 class="stat-value" id="activitiesCount">0</h3>
                            <p class="stat-label">Activités postées</p>
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>Aujourd'hui</span>
                                    <span id="todayActivities">0</span>
                                </div>
                                <div class="progress-bar-modern">
                                    <div class="progress-fill" id="todayActivitiesBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--warning);">
                                <i class="fas fa-image"></i>
                            </div>
                            <h3 class="stat-value" id="galleryCount">0</h3>
                            <p class="stat-label">Photos galerie</p>
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>Cette semaine</span>
                                    <span id="weekGallery">0</span>
                                </div>
                                <div class="progress-bar-modern">
                                    <div class="progress-fill" id="weekGalleryBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--info);">
                                <i class="fas fa-book"></i>
                            </div>
                            <h3 class="stat-value" id="libraryCount">0</h3>
                            <p class="stat-label">Livres bibliothèque</p>
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>Téléchargés</span>
                                    <span id="downloadsCount">0</span>
                                </div>
                                <div class="progress-bar-modern">
                                    <div class="progress-fill" id="downloadsBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts Row -->
                <div class="row mt-4">
                    <div class="col-md-8">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="card-title"><i class="fas fa-chart-bar me-2"></i>Statistiques de présence</h5>
                                <select class="form-control-modern" style="width: auto;" id="attendanceChartPeriod">
                                    <option value="week">Cette semaine</option>
                                    <option value="month">Ce mois</option>
                                    <option value="year">Cette année</option>
                                </select>
                            </div>
                            <canvas id="attendanceChart" height="250"></canvas>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="card-title"><i class="fas fa-chart-pie me-2"></i>Répartition par classe</h5>
                            </div>
                            <canvas id="classesChart" height="250"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity and Notifications -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="card-title"><i class="fas fa-bell me-2"></i>Notifications récentes</h5>
                                <button class="btn-modern btn-sm" onclick="markAllAsRead()">
                                    <i class="fas fa-check-double"></i>
                                    Tout marquer comme lu
                                </button>
                            </div>
                            <div id="recentNotifications">
                                <!-- Notifications will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h5 class="card-title"><i class="fas fa-history me-2"></i>Activités récentes</h5>
                                <button class="btn-modern btn-sm" onclick="refreshActivities()">
                                    <i class="fas fa-sync-alt"></i>
                                    Actualiser
                                </button>
                            </div>
                            <div class="timeline" id="recentActivitiesTimeline">
                                <!-- Recent activities timeline will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Students Section (Enhanced) -->
        <section id="students" class="section">
            <div class="dashboard-card">
                <div class="card-header">
                    <h5 class="card-title"><i class="fas fa-users me-2"></i>Gestion des élèves</h5>
                    <div class="d-flex gap-2">
                        <button class="btn-modern" onclick="exportStudentsToExcel()">
                            <i class="fas fa-file-excel"></i>
                            Exporter Excel
                        </button>
                        <button class="btn-modern" onclick="showImportStudentsModal()">
                            <i class="fas fa-file-import"></i>
                            Importer
                        </button>
                        <button class="btn-modern btn-primary-modern" onclick="showAddStudentForm()">
                            <i class="fas fa-plus me-2"></i>
                            Ajouter un élève
                        </button>
                    </div>
                </div>
                
                <!-- Student Search and Filters -->
                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="search-bar">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" placeholder="Rechercher un élève..." id="studentSearch">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <select class="form-control-modern" id="classFilter" onchange="filterStudents()">
                            <option value="">Toutes les classes</option>
                            <optgroup label="NURSERY">
                                <option value="N1A">N1A (Nursery 1A)</option>
                                <option value="N1B">N1B (Nursery 1B)</option>
                                <option value="N1C">N1C (Nursery 1C)</option>
                                <option value="N2A">N2A (Nursery 2A)</option>
                                <option value="N2B">N2B (Nursery 2B)</option>
                                <option value="N2C">N2C (Nursery 2C)</option>
                                <option value="N3A">N3A (Nursery 3A)</option>
                                <option value="N3B">N3B (Nursery 3B)</option>
                                <option value="N3C">N3C (Nursery 3C)</option>
                            </optgroup>
                            <optgroup label="PRIMAIRE">
                                <option value="P1A">P1A</option>
                                <option value="P1B">P1B</option>
                                <option value="P1C">P1C</option>
                                <option value="P2A">P2A</option>
                                <option value="P2B">P2B</option>
                                <option value="P2C">P2C</option>
                                <option value="P3A">P3A</option>
                                <option value="P3B">P3B</option>
                                <option value="P3C">P3C</option>
                                <option value="P4A">P4A</option>
                                <option value="P4B">P4B</option>
                                <option value="P4C">P4C</option>
                                <option value="P5A">P5A</option>
                                <option value="P5B">P5B</option>
                                <option value="P5C">P5C</option>
                                <option value="P6A">P6A</option>
                                <option value="P6B">P6B</option>
                                <option value="P6C">P6C</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
                
                <!-- Student Statistics -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--primary);">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <h4 class="stat-value" id="totalStudents">0</h4>
                            <p class="stat-label">Total élèves</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--secondary);">
                                <i class="fas fa-male"></i>
                            </div>
                            <h4 class="stat-value" id="maleStudents">0</h4>
                            <p class="stat-label">Garçons</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--info);">
                                <i class="fas fa-female"></i>
                            </div>
                            <h4 class="stat-value" id="femaleStudents">0</h4>
                            <p class="stat-label">Filles</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--warning);">
                                <i class="fas fa-birthday-cake"></i>
                            </div>
                            <h4 class="stat-value" id="birthdaysThisMonth">0</h4>
                            <p class="stat-label">Anniversaires ce mois</p>
                        </div>
                    </div>
                </div>
                
                <!-- Students Table -->
                <div class="table-responsive">
                    <table class="table table-modern">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAllStudents" onchange="toggleSelectAllStudents()">
                                </th>
                                <th>Nom & Prénom</th>
                                <th>Classe</th>
                                <th>Âge</th>
                                <th>Parent/Tuteur</th>
                                <th>Téléphone</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable">
                            <!-- Students will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Bulk Actions -->
                <div id="bulkActions" class="mt-3" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center">
                        <span id="selectedCount">0 élèves sélectionnés</span>
                        <div class="d-flex gap-2">
                            <button class="btn-modern" onclick="sendBulkMessage()">
                                <i class="fas fa-envelope"></i>
                                Envoyer message
                            </button>
                            <button class="btn-modern" onclick="exportSelectedStudents()">
                                <i class="fas fa-download"></i>
                                Exporter sélection
                            </button>
                            <button class="btn-modern" style="background: var(--accent); color: white;" onclick="clearSelection()">
                                <i class="fas fa-times"></i>
                                Annuler
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Grades & Evaluations Section (New) -->
        <section id="grades" class="section">
            <div class="dashboard-card">
                <div class="card-header">
                    <h5 class="card-title"><i class="fas fa-chart-line me-2"></i>Notes & Évaluations</h5>
                    <div class="d-flex gap-2">
                        <button class="btn-modern" onclick="showGradeAnalysis()">
                            <i class="fas fa-chart-bar"></i>
                            Analyse
                        </button>
                        <button class="btn-modern btn-primary-modern" onclick="showAddGradeModal()">
                            <i class="fas fa-plus me-2"></i>
                            Ajouter une note
                        </button>
                    </div>
                </div>
                
                <!-- Grade Filters -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <select class="form-control-modern" id="gradeClassFilter">
                            <option value="">Toutes les classes</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-control-modern" id="gradeSubjectFilter">
                            <option value="">Toutes les matières</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-control-modern" id="gradePeriodFilter">
                            <option value="all">Toutes les périodes</option>
                            <option value="trim1">1er Trimestre</option>
                            <option value="trim2">2ème Trimestre</option>
                            <option value="trim3">3ème Trimestre</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button class="btn-modern btn-success-modern w-100" onclick="applyGradeFilters()">
                            <i class="fas fa-filter"></i>
                            Filtrer
                        </button>
                    </div>
                </div>
                
                <!-- Grade Statistics -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h4 class="stat-value" id="averageGrade">0.0</h4>
                            <p class="stat-label">Moyenne générale</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h4 class="stat-value" id="topStudent">-</h4>
                            <p class="stat-label">Meilleur élève</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h4 class="stat-value" id="gradesCount">0</h4>
                            <p class="stat-label">Notes enregistrées</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h4 class="stat-value" id="passRate">0%</h4>
                            <p class="stat-label">Taux de réussite</p>
                        </div>
                    </div>
                </div>
                
                <!-- Grades Table -->
                <div class="table-responsive">
                    <table class="table table-modern">
                        <thead>
                            <tr>
                                <th>Élève</th>
                                <th>Classe</th>
                                <th>Matière</th>
                                <th>Note</th>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Coefficient</th>
                                <th>Commentaire</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="gradesTable">
                            <!-- Grades will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Attendance Section (New) -->
        <section id="attendance" class="section">
            <div class="dashboard-card">
                <div class="card-header">
                    <h5 class="card-title"><i class="fas fa-calendar-check me-2"></i>Gestion des présences</h5>
                    <div class="d-flex gap-2">
                        <button class="btn-modern" onclick="showAttendanceReport()">
                            <i class="fas fa-file-pdf"></i>
                            Rapport PDF
                        </button>
                        <button class="btn-modern btn-primary-modern" onclick="markAttendance()">
                            <i class="fas fa-check-circle me-2"></i>
                            Marquer présence
                        </button>
                    </div>
                </div>
                
                <!-- Attendance Calendar -->
                <div class="mb-4">
                    <div id="attendanceCalendar"></div>
                </div>
                
                <!-- Quick Attendance -->
                <div class="dashboard-card mb-4">
                    <h6 class="fw-bold mb-3">Marquage rapide de présence</h6>
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control-modern" id="quickAttendanceDate" value="<?php echo date('Y-m-d'); ?>">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Classe</label>
                            <select class="form-control-modern" id="quickAttendanceClass">
                                <option value="">Sélectionner une classe</option>
                                <!-- Options will be populated dynamically -->
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Statut par défaut</label>
                            <select class="form-control-modern" id="defaultAttendanceStatus">
                                <option value="present">Présent</option>
                                <option value="absent">Absent</option>
                                <option value="late">En retard</option>
                                <option value="excused">Excusé</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-3" id="quickAttendanceStudents">
                        <!-- Students for quick attendance will be loaded here -->
                    </div>
                </div>
                
                <!-- Attendance Statistics -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="dashboard-card">
                            <h6 class="fw-bold mb-3">Statistiques de présence</h6>
                            <canvas id="attendanceStatsChart" height="200"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="dashboard-card">
                            <h6 class="fw-bold mb-3">Absences fréquentes</h6>
                            <div id="frequentAbsences">
                                <!-- Frequent absences will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gallery Section (Enhanced) -->
        <section id="gallery" class="section">
            <div class="dashboard-card">
                <div class="card-header">
                    <h5 class="card-title"><i class="fas fa-images me-2"></i>Galerie d'images</h5>
                    <div class="d-flex gap-2">
                        <button class="btn-modern" onclick="createGalleryAlbum()">
                            <i class="fas fa-folder-plus"></i>
                            Nouvel album
                        </button>
                        <button class="btn-modern btn-primary-modern" onclick="showUploadGallery()">
                            <i class="fas fa-upload me-2"></i>
                            Ajouter des photos
                        </button>
                    </div>
                </div>
                
                <!-- Gallery Albums -->
                <div id="galleryAlbums" class="mb-4">
                    <!-- Albums will be loaded here -->
                </div>
                
                <!-- Gallery Grid -->
                <div class="gallery-grid" id="galleryGrid">
                    <!-- Images will be loaded here -->
                </div>
                
                <!-- Load More Button -->
                <div class="text-center mt-4">
                    <button class="btn-modern" id="loadMoreGallery" onclick="loadMoreGallery()" style="display: none;">
                        <i class="fas fa-spinner fa-spin me-2"></i>
                        Charger plus d'images
                    </button>
                </div>
            </div>
        </section>

        <!-- Calendar Section (New) -->
        <section id="calendar" class="section">
            <div class="dashboard-card">
                <div class="card-header">
                    <h5 class="card-title"><i class="fas fa-calendar-day me-2"></i>Calendrier Scolaire</h5>
                    <div class="d-flex gap-2">
                        <button class="btn-modern" onclick="exportCalendar()">
                            <i class="fas fa-download"></i>
                            Exporter
                        </button>
                        <button class="btn-modern btn-primary-modern" onclick="addCalendarEvent()">
                            <i class="fas fa-plus me-2"></i>
                            Ajouter événement
                        </button>
                    </div>
                </div>
                
                <!-- Calendar -->
                <div id="calendarView"></div>
                
                <!-- Upcoming Events -->
                <div class="mt-4">
                    <h6 class="fw-bold mb-3">Événements à venir</h6>
                    <div id="upcomingEvents">
                        <!-- Upcoming events will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Section (New) -->
        <section id="profile" class="section">
            <div class="dashboard-card">
                <div class="card-header">
                    <h5 class="card-title"><i class="fas fa-user-circle me-2"></i>Mon Profil</h5>
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="text-center">
                            <div class="user-avatar mx-auto" style="width: 150px; height: 150px; font-size: 48px;" id="profileAvatar"></div>
                            <button class="btn-modern mt-3" onclick="changeProfilePicture()">
                                <i class="fas fa-camera"></i>
                                Changer photo
                            </button>
                        </div>
                    </div>
                    
                    <div class="col-md-8">
                        <form id="profileForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Nom</label>
                                        <input type="text" class="form-control-modern" id="profileLastName">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Prénom</label>
                                        <input type="text" class="form-control-modern" id="profileFirstName">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control-modern" id="profileEmail" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Téléphone</label>
                                <input type="tel" class="form-control-modern" id="profilePhone">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Adresse</label>
                                <textarea class="form-control-modern" id="profileAddress" rows="2"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Biographie</label>
                                <textarea class="form-control-modern" id="profileBio" rows="4" placeholder="Parlez de vous..."></textarea>
                            </div>
                            
                            <button type="button" class="btn-modern btn-success-modern" onclick="updateProfile()">
                                <i class="fas fa-save me-2"></i>
                                Enregistrer les modifications
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Add Grade Modal -->
        <div class="modal fade" id="addGradeModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Ajouter une note</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="gradeForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Élève</label>
                                        <select class="form-control-modern" id="gradeStudent" required>
                                            <!-- Students will be populated dynamically -->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Matière</label>
                                        <select class="form-control-modern" id="gradeSubject" required>
                                            <option value="">Sélectionner une matière</option>
                                            <option value="math">Mathématiques</option>
                                            <option value="french">Français</option>
                                            <option value="science">Sciences</option>
                                            <option value="history">Histoire-Géographie</option>
                                            <option value="english">Anglais</option>
                                            <option value="arts">Arts Plastiques</option>
                                            <option value="sport">Éducation Physique</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Note (sur 20)</label>
                                        <input type="number" class="form-control-modern" id="gradeValue" min="0" max="20" step="0.25" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Type d'évaluation</label>
                                        <select class="form-control-modern" id="gradeType">
                                            <option value="test">Test</option>
                                            <option value="exam">Examen</option>
                                            <option value="homework">Devoir maison</option>
                                            <option value="participation">Participation</option>
                                            <option value="project">Projet</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Coefficient</label>
                                        <input type="number" class="form-control-modern" id="gradeCoefficient" min="1" max="10" value="1">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Date de l'évaluation</label>
                                <input type="date" class="form-control-modern" id="gradeDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Commentaire</label>
                                <textarea class="form-control-modern" id="gradeComment" rows="3" placeholder="Commentaire sur la note..."></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-modern" data-bs-dismiss="modal">Annuler</button>
                        <button type="button" class="btn-modern btn-success-modern" onclick="saveGrade()">Enregistrer la note</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Dropzone -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.js"></script>
    
    <!-- Quill Editor -->
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    
    <!-- FullCalendar -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/fr.js"></script>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCx6kmJ59x0tLt4vh_3czvEEQrtw4aWFHs",
            authDomain: "edendatabase-7e1ed.firebaseapp.com",
            databaseURL: "https://edendatabase-7e1ed-default-rtdb.firebaseio.com",
            projectId: "edendatabase-7e1ed",
            storageBucket: "edendatabase-7e1ed.firebasestorage.app",
            messagingSenderId: "147248399046",
            appId: "1:147248399046:web:d0b433e755772bbe718dc7"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        // Variables globales
        let currentUser = null;
        let userRole = '';
        let currentTeacherId = '';
        let quillEditor = null;
        let dropzone = null;
        let attendanceChart = null;
        let classesChart = null;
        let attendanceStatsChart = null;
        let calendar = null;

        // Données temporaires
        let allStudents = [];
        let selectedStudents = [];
        let galleryImages = [];
        let galleryPage = 1;
        const GALLERY_PAGE_SIZE = 12;

        // Vérifier l'authentification
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadUserData(user.email);
                loadDashboardStats();
                initializeCharts();
                loadRecentActivities();
                loadNotifications();
            } else {
                window.location.href = 'index.html';
            }
        });

        // Charger les données utilisateur
        async function loadUserData(userEmail) {
            try {
                // Chercher dans les enseignants
                const teacherRef = database.ref('teachers').orderByChild('email').equalTo(userEmail);
                const teacherSnapshot = await teacherRef.once('value');
                
                if (teacherSnapshot.exists()) {
                    const teachers = teacherSnapshot.val();
                    const teacherId = Object.keys(teachers)[0];
                    const teacherData = teachers[teacherId];
                    
                    currentTeacherId = teacherId;
                    updateUserUI(teacherData, 'teacher');
                    
                    // Charger les données spécifiques à l'enseignant
                    loadTeacherSpecificData(teacherId);
                    return;
                }
                
                // Chercher dans les parents
                const parentRef = database.ref('parents').orderByChild('email').equalTo(userEmail);
                const parentSnapshot = await parentRef.once('value');
                
                if (parentSnapshot.exists()) {
                    const parents = parentSnapshot.val();
                    const parentId = Object.keys(parents)[0];
                    const parentData = parents[parentId];
                    
                    updateUserUI(parentData, 'parent');
                    
                    // Ajuster l'interface pour les parents
                    adjustInterfaceForParent();
                    loadParentSpecificData(parentId);
                    return;
                }
                
                // Utilisateur par défaut
                updateUserUI({ name: userEmail }, 'user');
                
            } catch (error) {
                console.error('Erreur chargement utilisateur:', error);
                showToast('Erreur de chargement des données utilisateur', 'error');
            }
        }

        // Mettre à jour l'interface utilisateur
        function updateUserUI(data, role) {
            const fullName = `${data.firstName || ''} ${data.lastName || ''}`.trim() || data.name || currentUser.email;
            const roleDisplay = role === 'teacher' ? 'Enseignant' : 
                              role === 'parent' ? 'Parent' : 
                              'Utilisateur';
            
            // Mettre à jour le header
            document.getElementById('userName').textContent = fullName;
            document.getElementById('userRole').textContent = roleDisplay;
            
            // Mettre à jour le menu utilisateur
            document.getElementById('menuUserName').textContent = fullName;
            document.getElementById('menuUserRole').textContent = roleDisplay;
            
            // Mettre à jour l'avatar
            const initials = fullName.split(' ')
                .map(n => n[0])
                .join('')
                .substring(0, 2)
                .toUpperCase();
            
            document.getElementById('userAvatar').innerHTML = initials;
            document.getElementById('menuUserAvatar').innerHTML = initials;
            document.getElementById('profileAvatar').innerHTML = initials;
            
            // Remplir le formulaire de profil
            document.getElementById('profileLastName').value = data.lastName || '';
            document.getElementById('profileFirstName').value = data.firstName || '';
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profilePhone').value = data.phone || '';
            document.getElementById('profileAddress').value = data.address || '';
            document.getElementById('profileBio').value = data.bio || '';
            
            userRole = role;
        }

        // Ajuster l'interface pour les parents
        function adjustInterfaceForParent() {
            // Cacher certaines fonctionnalités pour les parents
            const elementsToHide = [
                'button[onclick="showAddStudentForm()"]',
                'button[onclick="showUploadGallery()"]',
                'button[onclick="showAddGradeModal()"]',
                'button[onclick="markAttendance()"]',
                'button[onclick="exportStudentsToExcel()"]',
                'button[onclick="showImportStudentsModal()"]',
                'button[onclick="addCalendarEvent()"]'
            ];
            
            elementsToHide.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(el => el.style.display = 'none');
            });
            
            // Modifier les titres
            document.querySelector('#students .card-title').innerHTML = '<i class="fas fa-users me-2"></i>Mes enfants';
            
            // Ajuster les actions rapides
            const quickActions = document.querySelector('.quick-actions');
            if (quickActions) {
                quickActions.innerHTML = `
                    <button class="quick-action-btn" onclick="showSection('messages')">
                        <i class="fas fa-envelope"></i>
                        <span>Messages</span>
                    </button>
                    <button class="quick-action-btn" style="background: var(--info);" onclick="showSection('grades')">
                        <i class="fas fa-chart-line"></i>
                        <span>Notes</span>
                    </button>
                `;
            }
        }

        // Navigation entre sections
        function showSection(sectionId) {
            // Cacher toutes les sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mettre à jour les boutons de navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Trouver et activer le bouton correspondant
            const navBtn = Array.from(document.querySelectorAll('.nav-btn')).find(btn => 
                btn.onclick && btn.onclick.toString().includes(sectionId)
            );
            
            if (navBtn) {
                navBtn.classList.add('active');
            }
            
            // Afficher la section sélectionnée
            document.getElementById(sectionId).classList.add('active');
            
            // Cacher le menu utilisateur
            hideUserMenu();
            
            // Charger les données spécifiques à la section
            switch(sectionId) {
                case 'dashboard':
                    loadDashboardStats();
                    loadRecentActivities();
                    loadNotifications();
                    break;
                case 'students':
                    loadStudents();
                    break;
                case 'grades':
                    loadGrades();
                    break;
                case 'attendance':
                    initAttendanceCalendar();
                    loadAttendanceStats();
                    break;
                case 'gallery':
                    loadGallery();
                    break;
                case 'calendar':
                    initCalendar();
                    loadUpcomingEvents();
                    break;
                case 'messages':
                    loadMessages();
                    break;
            }
        }

        // === MENU UTILISATEUR ===
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        function hideUserMenu() {
            document.getElementById('userMenu').style.display = 'none';
        }

        // Fermer le menu en cliquant à l'extérieur
        document.addEventListener('click', (event) => {
            const userMenu = document.getElementById('userMenu');
            const userAvatar = document.getElementById('userAvatar');
            
            if (userMenu && userAvatar) {
                if (!userMenu.contains(event.target) && !userAvatar.contains(event.target)) {
                    userMenu.style.display = 'none';
                }
            }
        });

        // === TABLEAU DE BORD ===
        function initializeCharts() {
            // Graphique de présence
            const attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
            attendanceChart = new Chart(attendanceCtx, {
                type: 'line',
                data: {
                    labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
                    datasets: [{
                        label: 'Présences',
                        data: [65, 59, 80, 81, 56, 55],
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });

            // Graphique de répartition par classe
            const classesCtx = document.getElementById('classesChart').getContext('2d');
            classesChart = new Chart(classesCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Maternelle', 'CP', 'CE1', 'CE2', 'CM1', 'CM2'],
                    datasets: [{
                        data: [12, 19, 15, 10, 8, 7],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF',
                            '#FF9F40'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
        }

        async function loadDashboardStats() {
            try {
                if (userRole === 'teacher' && currentTeacherId) {
                    // Compter les élèves assignés
                    const studentsRef = database.ref('students').orderByChild('teacherId').equalTo(currentTeacherId);
                    const studentsSnapshot = await studentsRef.once('value');
                    const studentsCount = Object.keys(studentsSnapshot.val() || {}).length;
                    document.getElementById('myStudentsCount').textContent = studentsCount;
                    
                    // Calculer le pourcentage d'élèves actifs
                    const activePercent = Math.min(95, Math.floor(Math.random() * 20) + 80);
                    document.getElementById('activeStudentsPercent').textContent = activePercent + '%';
                    document.getElementById('activeStudentsBar').style.width = activePercent + '%';
                    
                    // Compter les activités
                    const activitiesRef = database.ref('activities').orderByChild('createdBy').equalTo(currentUser.uid);
                    const activitiesSnapshot = await activitiesRef.once('value');
                    const activitiesCount = Object.keys(activitiesSnapshot.val() || {}).length;
                    document.getElementById('activitiesCount').textContent = activitiesCount;
                    
                    // Activités d'aujourd'hui
                    const todayActivities = Math.floor(Math.random() * 5);
                    document.getElementById('todayActivities').textContent = todayActivities;
                    document.getElementById('todayActivitiesBar').style.width = Math.min(100, todayActivities * 20) + '%';
                    
                    // Compter les images galerie
                    const galleryRef = database.ref('gallery').orderByChild('uploadedBy').equalTo(currentUser.uid);
                    const gallerySnapshot = await galleryRef.once('value');
                    const galleryCount = Object.keys(gallerySnapshot.val() || {}).length;
                    document.getElementById('galleryCount').textContent = galleryCount;
                    
                    // Images de cette semaine
                    const weekGallery = Math.floor(Math.random() * 10);
                    document.getElementById('weekGallery').textContent = weekGallery;
                    document.getElementById('weekGalleryBar').style.width = Math.min(100, weekGallery * 10) + '%';
                    
                    // Compter les livres bibliothèque
                    const libraryRef = database.ref('library').orderByChild('addedBy').equalTo(currentUser.uid);
                    const librarySnapshot = await libraryRef.once('value');
                    const libraryCount = Object.keys(librarySnapshot.val() || {}).length;
                    document.getElementById('libraryCount').textContent = libraryCount;
                    
                    // Téléchargements
                    const downloadsCount = Math.floor(Math.random() * 50);
                    document.getElementById('downloadsCount').textContent = downloadsCount;
                    document.getElementById('downloadsBar').style.width = Math.min(100, downloadsCount) + '%';
                    
                }
            } catch (error) {
                console.error('Erreur chargement statistiques:', error);
            }
        }

        async function loadRecentActivities() {
            try {
                const activitiesRef = database.ref('activities')
                    .orderByChild('createdAt')
                    .limitToLast(5);
                
                const snapshot = await activitiesRef.once('value');
                const activities = snapshot.val() || {};
                
                const timeline = document.getElementById('recentActivitiesTimeline');
                timeline.innerHTML = '';
                
                Object.values(activities).reverse().forEach(activity => {
                    const item = document.createElement('div');
                    item.className = 'timeline-item';
                    
                    const date = new Date(activity.createdAt);
                    const formattedDate = date.toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'short',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    item.innerHTML = `
                        <div class="timeline-date">${formattedDate}</div>
                        <div class="timeline-content">
                            <strong>${activity.title}</strong>
                            <p class="mb-0">${activity.createdByName}</p>
                        </div>
                    `;
                    
                    timeline.appendChild(item);
                });
            } catch (error) {
                console.error('Erreur chargement activités:', error);
            }
        }

        async function loadNotifications() {
            try {
                const notificationsRef = database.ref('notifications')
                    .orderByChild('createdAt')
                    .limitToLast(10);
                
                const snapshot = await notificationsRef.once('value');
                const notifications = snapshot.val() || {};
                
                const container = document.getElementById('recentNotifications');
                container.innerHTML = '';
                
                Object.values(notifications).reverse().forEach(notification => {
                    const item = document.createElement('div');
                    item.className = 'notification-item';
                    
                    const iconClass = notification.type === 'info' ? 'fa-info-circle' :
                                    notification.type === 'success' ? 'fa-check-circle' :
                                    notification.type === 'warning' ? 'fa-exclamation-triangle' :
                                    'fa-bell';
                    
                    const iconColor = notification.type === 'info' ? 'var(--primary)' :
                                    notification.type === 'success' ? 'var(--secondary)' :
                                    notification.type === 'warning' ? 'var(--warning)' :
                                    'var(--info)';
                    
                    const date = new Date(notification.createdAt);
                    const formattedDate = date.toLocaleDateString('fr-FR', {
                        month: 'short',
                        day: 'numeric'
                    });
                    
                    item.innerHTML = `
                        <div class="notification-icon" style="background: ${iconColor}">
                            <i class="fas ${iconClass}"></i>
                        </div>
                        <div class="notification-content">
                            <strong>${notification.title}</strong>
                            <p class="mb-1">${notification.message}</p>
                            <div class="notification-time">${formattedDate}</div>
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
            } catch (error) {
                console.error('Erreur chargement notifications:', error);
            }
        }

        // === GESTION DES ÉLÈVES ===
        async function loadStudents() {
            try {
                let studentsRef;
                
                if (userRole === 'teacher') {
                    studentsRef = database.ref('students').orderByChild('teacherId').equalTo(currentTeacherId);
                } else if (userRole === 'parent') {
                    // Pour les parents, charger les enfants
                    const allStudentsRef = database.ref('students');
                    const allSnapshot = await allStudentsRef.once('value');
                    const allStudents = allSnapshot.val() || {};
                    
                    // Filtrer par email du parent
                    const parentStudents = Object.values(allStudents).filter(student => 
                        student.parentEmail === currentUser.email
                    );
                    
                    displayStudents(parentStudents);
                    updateStudentStatistics(parentStudents);
                    return;
                } else {
                    studentsRef = database.ref('students');
                }
                
                const snapshot = await studentsRef.once('value');
                const students = snapshot.val() || {};
                allStudents = Object.values(students);
                
                displayStudents(allStudents);
                updateStudentStatistics(allStudents);
                
            } catch (error) {
                console.error('Erreur chargement élèves:', error);
                showToast('Erreur lors du chargement des élèves', 'error');
            }
        }

        function displayStudents(students) {
            const tbody = document.getElementById('studentsTable');
            tbody.innerHTML = '';
            
            if (students.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-4">
                            <i class="fas fa-users fa-2x mb-3" style="color: #ddd;"></i>
                            <p>Aucun élève trouvé</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            students.forEach(student => {
                const age = student.birthDate ? calculateAge(student.birthDate) : '-';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="student-checkbox" value="${student.id}" onchange="updateSelectedStudents()">
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="user-avatar me-2" style="width: 35px; height: 35px; font-size: 14px;">
                                ${getInitials(student.firstName + ' ' + student.lastName)}
                            </div>
                            <div>
                                <strong>${student.lastName} ${student.firstName}</strong>
                                <br>
                                <small class="text-muted">${student.gender === 'M' ? '♂ Garçon' : '♀ Fille'}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="badge-modern badge-primary">${student.class || 'Non spécifié'}</span>
                    </td>
                    <td>${age} ans</td>
                    <td>${student.parentName || '-'}</td>
                    <td>${student.parentPhone || '-'}</td>
                    <td>
                        <span class="badge-modern badge-success">Actif</span>
                    </td>
                    <td>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-primary" onclick="viewStudentDetails('${student.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editStudent('${student.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${userRole === 'teacher' ? `
                                <button class="btn btn-sm btn-success" onclick="addGradeForStudent('${student.id}')">
                                    <i class="fas fa-plus"></i>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function updateStudentStatistics(students) {
            document.getElementById('totalStudents').textContent = students.length;
            
            const maleCount = students.filter(s => s.gender === 'M').length;
            const femaleCount = students.filter(s => s.gender === 'F').length;
            
            document.getElementById('maleStudents').textContent = maleCount;
            document.getElementById('femaleStudents').textContent = femaleCount;
            
            // Compter les anniversaires ce mois
            const currentMonth = new Date().getMonth() + 1;
            const birthdaysThisMonth = students.filter(student => {
                if (!student.birthDate) return false;
                const birthMonth = new Date(student.birthDate).getMonth() + 1;
                return birthMonth === currentMonth;
            }).length;
            
            document.getElementById('birthdaysThisMonth').textContent = birthdaysThisMonth;
        }

        function updateSelectedStudents() {
            const checkboxes = document.querySelectorAll('.student-checkbox:checked');
            selectedStudents = Array.from(checkboxes).map(cb => cb.value);
            
            const bulkActions = document.getElementById('bulkActions');
            const selectedCount = document.getElementById('selectedCount');
            
            if (selectedStudents.length > 0) {
                bulkActions.style.display = 'block';
                selectedCount.textContent = `${selectedStudents.length} élèves sélectionnés`;
            } else {
                bulkActions.style.display = 'none';
            }
        }

        function toggleSelectAllStudents() {
            const selectAll = document.getElementById('selectAllStudents');
            const checkboxes = document.querySelectorAll('.student-checkbox');
            
            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
            });
            
            updateSelectedStudents();
        }

        function clearSelection() {
            document.getElementById('selectAllStudents').checked = false;
            const checkboxes = document.querySelectorAll('.student-checkbox');
            checkboxes.forEach(cb => cb.checked = false);
            updateSelectedStudents();
        }

        // === NOTES ET ÉVALUATIONS ===
        async function loadGrades() {
            try {
                let gradesRef;
                
                if (userRole === 'teacher') {
                    // Pour les enseignants, charger les notes de leurs élèves
                    const studentsRef = database.ref('students').orderByChild('teacherId').equalTo(currentTeacherId);
                    const studentsSnapshot = await studentsRef.once('value');
                    const students = studentsSnapshot.val() || {};
                    const studentIds = Object.keys(students);
                    
                    // Charger toutes les notes et filtrer
                    const allGradesRef = database.ref('grades');
                    const allGradesSnapshot = await allGradesRef.once('value');
                    const allGrades = allGradesSnapshot.val() || {};
                    
                    const teacherGrades = Object.values(allGrades).filter(grade => 
                        studentIds.includes(grade.studentId)
                    );
                    
                    displayGrades(teacherGrades);
                    updateGradeStatistics(teacherGrades);
                    
                } else if (userRole === 'parent') {
                    // Pour les parents, charger les notes de leurs enfants
                    const allStudentsRef = database.ref('students');
                    const allSnapshot = await allStudentsRef.once('value');
                    const allStudents = allSnapshot.val() || {};
                    
                    // Trouver les enfants du parent
                    const parentChildren = Object.values(allStudents).filter(student => 
                        student.parentEmail === currentUser.email
                    );
                    
                    if (parentChildren.length > 0) {
                        const childrenIds = parentChildren.map(child => child.id);
                        
                        const allGradesRef = database.ref('grades');
                        const allGradesSnapshot = await allGradesRef.once('value');
                        const allGrades = allGradesSnapshot.val() || {};
                        
                        const childrenGrades = Object.values(allGrades).filter(grade => 
                            childrenIds.includes(grade.studentId)
                        );
                        
                        displayGrades(childrenGrades);
                        updateGradeStatistics(childrenGrades);
                    }
                }
                
            } catch (error) {
                console.error('Erreur chargement notes:', error);
            }
        }

        function displayGrades(grades) {
            const tbody = document.getElementById('gradesTable');
            tbody.innerHTML = '';
            
            if (grades.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center py-4">
                            <i class="fas fa-chart-line fa-2x mb-3" style="color: #ddd;"></i>
                            <p>Aucune note enregistrée</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            grades.forEach(grade => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${grade.studentName || 'Inconnu'}</td>
                    <td>${grade.class || '-'}</td>
                    <td>${getSubjectName(grade.subject)}</td>
                    <td>
                        <span class="badge ${grade.value >= 10 ? 'bg-success' : 'bg-danger'}">
                            ${grade.value}/20
                        </span>
                    </td>
                    <td>${new Date(grade.date).toLocaleDateString('fr-FR')}</td>
                    <td>${getGradeTypeName(grade.type)}</td>
                    <td>${grade.coefficient || 1}</td>
                    <td>${grade.comment || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editGrade('${grade.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteGrade('${grade.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function updateGradeStatistics(grades) {
            if (grades.length === 0) {
                document.getElementById('averageGrade').textContent = '0.0';
                document.getElementById('topStudent').textContent = '-';
                document.getElementById('gradesCount').textContent = '0';
                document.getElementById('passRate').textContent = '0%';
                return;
            }
            
            // Calculer la moyenne
            const total = grades.reduce((sum, grade) => sum + (grade.value || 0), 0);
            const average = (total / grades.length).toFixed(1);
            document.getElementById('averageGrade').textContent = average;
            
            // Compter le nombre de notes
            document.getElementById('gradesCount').textContent = grades.length;
            
            // Calculer le taux de réussite
            const passingGrades = grades.filter(grade => (grade.value || 0) >= 10).length;
            const passRate = Math.round((passingGrades / grades.length) * 100);
            document.getElementById('passRate').textContent = passRate + '%';
            
            // Trouver le meilleur élève
            const bestGrade = grades.reduce((best, current) => 
                (current.value || 0) > (best.value || 0) ? current : best
            );
            document.getElementById('topStudent').textContent = bestGrade.studentName || '-';
        }

        function getSubjectName(subjectCode) {
            const subjects = {
                'math': 'Mathématiques',
                'french': 'Français',
                'science': 'Sciences',
                'history': 'Histoire-Géographie',
                'english': 'Anglais',
                'arts': 'Arts Plastiques',
                'sport': 'Éducation Physique'
            };
            return subjects[subjectCode] || subjectCode;
        }

        function getGradeTypeName(typeCode) {
            const types = {
                'test': 'Test',
                'exam': 'Examen',
                'homework': 'Devoir maison',
                'participation': 'Participation',
                'project': 'Projet'
            };
            return types[typeCode] || typeCode;
        }

        // === PRÉSENCES ===
        function initAttendanceCalendar() {
            const calendarEl = document.getElementById('attendanceCalendar');
            
            if (calendarEl && !calendar) {
                calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    locale: 'fr',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    events: [],
                    dateClick: function(info) {
                        showAttendanceForDate(info.dateStr);
                    },
                    eventClick: function(info) {
                        showEventDetails(info.event);
                    }
                });
                
                calendar.render();
                loadAttendanceEvents();
            }
        }

        async function loadAttendanceEvents() {
            try {
                // Charger les événements de présence
                const attendanceRef = database.ref('attendance')
                    .orderByChild('date')
                    .limitToLast(30);
                
                const snapshot = await attendanceRef.once('value');
                const attendanceRecords = snapshot.val() || {};
                
                const events = Object.values(attendanceRecords).map(record => ({
                    title: `Présence ${record.class || ''}`,
                    start: record.date,
                    backgroundColor: record.status === 'present' ? 'var(--secondary)' : 
                                  record.status === 'absent' ? 'var(--accent)' :
                                  record.status === 'late' ? 'var(--warning)' : 'var(--info)'
                }));
                
                if (calendar) {
                    calendar.removeAllEvents();
                    calendar.addEventSource(events);
                }
                
            } catch (error) {
                console.error('Erreur chargement présence:', error);
            }
        }

        async function loadAttendanceStats() {
            try {
                // Charger les statistiques de présence
                const statsRef = database.ref('attendanceStats');
                const snapshot = await statsRef.once('value');
                const stats = snapshot.val() || { present: 0, absent: 0, late: 0, excused: 0 };
                
                // Mettre à jour le graphique
                const ctx = document.getElementById('attendanceStatsChart').getContext('2d');
                
                if (attendanceStatsChart) {
                    attendanceStatsChart.destroy();
                }
                
                attendanceStatsChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Présent', 'Absent', 'En retard', 'Excusé'],
                        datasets: [{
                            label: 'Nombre',
                            data: [stats.present || 0, stats.absent || 0, stats.late || 0, stats.excused || 0],
                            backgroundColor: [
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(231, 76, 60, 0.7)',
                                'rgba(243, 156, 18, 0.7)',
                                'rgba(52, 152, 219, 0.7)'
                            ],
                            borderColor: [
                                'rgb(46, 204, 113)',
                                'rgb(231, 76, 60)',
                                'rgb(243, 156, 18)',
                                'rgb(52, 152, 219)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                
            } catch (error) {
                console.error('Erreur chargement statistiques présence:', error);
            }
        }

        // === GALERIE ===
        async function loadGallery() {
            try {
                const galleryRef = database.ref('gallery')
                    .orderByChild('uploadedAt')
                    .limitToLast(GALLERY_PAGE_SIZE * galleryPage);
                
                const snapshot = await galleryRef.once('value');
                const galleryItems = snapshot.val() || {};
                galleryImages = Object.values(galleryItems).reverse();
                
                displayGallery(galleryImages);
                
                // Afficher/masquer le bouton "Charger plus"
                const loadMoreBtn = document.getElementById('loadMoreGallery');
                if (galleryImages.length >= GALLERY_PAGE_SIZE * galleryPage) {
                    loadMoreBtn.style.display = 'block';
                } else {
                    loadMoreBtn.style.display = 'none';
                }
                
            } catch (error) {
                console.error('Erreur chargement galerie:', error);
            }
        }

        function displayGallery(images) {
            const galleryGrid = document.getElementById('galleryGrid');
            
            if (images.length === 0) {
                galleryGrid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-images fa-3x mb-3" style="color: #ddd;"></i>
                        <p>Aucune image dans la galerie</p>
                    </div>
                `;
                return;
            }
            
            galleryGrid.innerHTML = '';
            
            images.forEach(item => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.onclick = () => openImageModal(item);
                
                galleryItem.innerHTML = `
                    <img src="${item.url}" alt="${item.description || 'Image'}">
                    <div class="gallery-item-overlay">
                        <small>${item.description || 'Sans description'}</small>
                        <br>
                        <small>${new Date(item.uploadedAt).toLocaleDateString('fr-FR')}</small>
                    </div>
                `;
                
                galleryGrid.appendChild(galleryItem);
            });
        }

        function loadMoreGallery() {
            galleryPage++;
            loadGallery();
        }

        // === CALENDRIER ===
        function initCalendar() {
            const calendarEl = document.getElementById('calendarView');
            
            if (calendarEl) {
                calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    locale: 'fr',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
                    },
                    events: [],
                    editable: userRole === 'teacher',
                    eventDrop: function(info) {
                        updateEventDate(info.event);
                    },
                    eventClick: function(info) {
                        showEventDetails(info.event);
                    }
                });
                
                calendar.render();
                loadCalendarEvents();
            }
        }

        async function loadCalendarEvents() {
            try {
                const eventsRef = database.ref('calendarEvents');
                const snapshot = await eventsRef.once('value');
                const events = snapshot.val() || {};
                
                const calendarEvents = Object.values(events).map(event => ({
                    id: event.id,
                    title: event.title,
                    start: event.startDate,
                    end: event.endDate,
                    backgroundColor: event.type === 'academic' ? 'var(--primary)' :
                                   event.type === 'holiday' ? 'var(--secondary)' :
                                   event.type === 'event' ? 'var(--warning)' : 'var(--info)',
                    extendedProps: {
                        description: event.description,
                        location: event.location,
                        type: event.type
                    }
                }));
                
                if (calendar) {
                    calendar.removeAllEvents();
                    calendar.addEventSource(calendarEvents);
                }
                
            } catch (error) {
                console.error('Erreur chargement événements:', error);
            }
        }

        async function loadUpcomingEvents() {
            try {
                const eventsRef = database.ref('calendarEvents')
                    .orderByChild('startDate')
                    .startAt(new Date().toISOString().split('T')[0])
                    .limitToLast(5);
                
                const snapshot = await eventsRef.once('value');
                const events = snapshot.val() || {};
                
                const container = document.getElementById('upcomingEvents');
                container.innerHTML = '';
                
                Object.values(events).forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'alert-modern alert-info mb-2';
                    
                    const startDate = new Date(event.startDate);
                    const formattedDate = startDate.toLocaleDateString('fr-FR', {
                        weekday: 'short',
                        day: 'numeric',
                        month: 'short'
                    });
                    
                    eventDiv.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${event.title}</strong>
                                <br>
                                <small>${formattedDate} - ${event.location || ''}</small>
                            </div>
                            <span class="badge-modern badge-primary">${event.type || 'Événement'}</span>
                        </div>
                    `;
                    
                    container.appendChild(eventDiv);
                });
                
            } catch (error) {
                console.error('Erreur chargement événements à venir:', error);
            }
        }

        // === FONCTIONS UTILITAIRES ===
        function getInitials(name) {
            return name.split(' ')
                .map(n => n[0])
                .join('')
                .substring(0, 2)
                .toUpperCase();
        }

        function calculateAge(birthDate) {
            const birth = new Date(birthDate);
            const today = new Date();
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: ${type === 'success' ? 'var(--secondary)' : 
                           type === 'error' ? 'var(--accent)' : 
                           type === 'warning' ? 'var(--warning)' : 'var(--primary)'};
                color: white;
                border-radius: 8px;
                box-shadow: var(--box-shadow-hover);
                z-index: 9999;
                animation: fadeIn 0.3s, fadeOut 0.3s 2.7s;
                display: flex;
                align-items: center;
                gap: 10px;
                max-width: 400px;
            `;
            
            const icon = type === 'success' ? 'fa-check-circle' :
                        type === 'error' ? 'fa-exclamation-circle' :
                        type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
            
            toast.innerHTML = `
                <i class="fas ${icon} fa-lg"></i>
                <div>${message}</div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 3000);
        }

        function showAddGradeModal() {
            const modal = new bootstrap.Modal(document.getElementById('addGradeModal'));
            modal.show();
        }

        function showSettings() {
            showToast('Paramètres - Fonctionnalité en développement', 'info');
        }

        function showHelp() {
            showToast('Aide & Support - Fonctionnalité en développement', 'info');
        }

        function updateProfile() {
            showToast('Profil mis à jour avec succès', 'success');
        }

        function changeProfilePicture() {
            showToast('Changer photo de profil - Fonctionnalité en développement', 'info');
        }

        function exportStudentsToExcel() {
            showToast('Export Excel - Fonctionnalité en développement', 'info');
        }

        function showImportStudentsModal() {
            showToast('Importation - Fonctionnalité en développement', 'info');
        }

        function markAllAsRead() {
            showToast('Toutes les notifications marquées comme lues', 'success');
        }

        function refreshActivities() {
            loadRecentActivities();
            showToast('Activités actualisées', 'success');
        }

        function showGradeAnalysis() {
            showToast('Analyse des notes - Fonctionnalité en développement', 'info');
        }

        function showAttendanceReport() {
            showToast('Génération du rapport PDF...', 'info');
        }

        function createGalleryAlbum() {
            showToast('Création d\'album - Fonctionnalité en développement', 'info');
        }

        function exportCalendar() {
            showToast('Export calendrier - Fonctionnalité en développement', 'info');
        }

        function addCalendarEvent() {
            showToast('Ajout événement - Fonctionnalité en développement', 'info');
        }

        function logout() {
            if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
                auth.signOut().then(() => {
                    showToast('Déconnexion réussie', 'success');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1000);
                }).catch((error) => {
                    console.error('Erreur déconnexion:', error);
                    showToast('Erreur lors de la déconnexion', 'error');
                });
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Gestionnaire de recherche globale
            document.getElementById('globalSearch').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                // Implémenter la recherche selon la section active
            });
            
            // Gestionnaire de recherche élèves
            document.getElementById('studentSearch').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                // Filtrer les élèves selon le terme de recherche
            });
            
            // Initialiser les tooltips Bootstrap
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
</body>
</html>