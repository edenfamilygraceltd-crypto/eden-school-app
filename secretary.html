<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portail Secr√©taire - Eden Family School</title>
  
  <!-- üîí S√âCURIT√â: Script d'authentification -->
  <script src="security-auth.js"></script>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="responsive.css">
  
  <style>
    :root {
      --primary: #2c3e50;
      --primary-light: #34495e;
      --secondary: #3498db;
      --secondary-light: #5dade2;
      --accent: #16a085;
      --accent-light: #1abc9c;
      --success: #27ae60;
      --danger: #e74c3c;
      --warning: #f39c12;
      --info: #3498db;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --gray: #7f8c8d;
      --gray-light: #bdc3c7;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--light) 0%, #dfe6e9 100%);
      min-height: 100vh;
      padding: 20px 0;
      color: var(--dark);
      display: flex;
      flex-direction: column;
    }
    
    .navbar {
      background: white !important;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 15px rgba(44, 62, 80, 0.08);
      border-radius: 12px;
      margin: 0 20px 20px 20px;
      border: 1px solid rgba(189, 195, 199, 0.2);
    }
    /* Custom scrollbar theme to match app colors */
    .table-responsive::-webkit-scrollbar {
      height: 8px;
      width: 8px;
    }
    .table-responsive::-webkit-scrollbar-track {
      background: var(--light);
    }
    .table-responsive::-webkit-scrollbar-thumb {
      background: var(--secondary);
      border-radius: 4px;
    }
    .table-responsive {
      scrollbar-color: var(--secondary) var(--light);
      scrollbar-width: thin;
    }
    
    .navbar-brand {
      font-weight: 700;
      font-size: 1.5rem;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .main-container {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 30px rgba(44, 62, 80, 0.1);
      margin: 0 20px 20px 20px;
      border: 1px solid rgba(189, 195, 199, 0.3);
      flex: 1;
    }
    
    .sidebar {
      background: linear-gradient(160deg, var(--primary) 0%, var(--primary-light) 100%);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(44, 62, 80, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .sidebar .list-group-item {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 8px;
      border-radius: 10px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      font-weight: 500;
    }
    
    .sidebar .list-group-item:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateX(5px);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .sidebar .list-group-item.active {
      background: white;
      color: var(--primary);
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(44, 62, 80, 0.15);
      border: 1px solid white;
    }
    
    .stat-card {
      background: white;
      border-radius: 14px;
      padding: 20px;
      color: var(--dark);
      text-align: center;
      margin-bottom: 15px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      border: 1px solid rgba(189, 195, 199, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--secondary);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(44, 62, 80, 0.12);
      border-color: var(--secondary-light);
    }
    
    .stat-card.students::before {
      background: linear-gradient(90deg, var(--secondary), var(--secondary-light));
    }
    
    .stat-card.teachers::before {
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
    }
    
    .stat-card.assignments::before {
      background: linear-gradient(90deg, var(--warning), #f1c40f);
    }
    
    .stat-card.books::before {
      background: linear-gradient(90deg, var(--success), #2ecc71);
    }
    
    .stat-card i {
      font-size: 2.5rem;
      margin-bottom: 10px;
      display: block;
    }
    
    .stat-card.students i {
      color: var(--secondary);
    }
    
    .stat-card.teachers i {
      color: var(--accent);
    }
    
    .stat-card.assignments i {
      color: var(--warning);
    }
    
    .stat-card.books i {
      color: var(--success);
    }
    
    .stat-card h2 {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 10px 0;
      color: var(--dark);
    }
    
    .stat-card small {
      font-size: 0.9rem;
      color: var(--gray);
      font-weight: 500;
    }
    
    .card {
      border: 1px solid rgba(189, 195, 199, 0.3);
      border-radius: 14px;
      box-shadow: 0 4px 15px rgba(44, 62, 80, 0.08);
      margin-bottom: 20px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .card:hover {
      box-shadow: 0 8px 25px rgba(44, 62, 80, 0.12);
    }
    
    .card-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      font-weight: 600;
      padding: 18px 20px;
      border: none;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
      border: none;
      padding: 10px 25px;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(52, 152, 219, 0.3);
      background: linear-gradient(135deg, var(--secondary-light) 0%, var(--secondary) 100%);
    }
    
    .btn-outline-primary {
      color: var(--secondary);
      border-color: var(--secondary);
    }
    
    .btn-outline-primary:hover {
      background: var(--secondary);
      border-color: var(--secondary);
    }
    
    .btn-light {
      background: var(--light);
      border-color: var(--gray-light);
      color: var(--dark);
    }
    
    .table {
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid rgba(189, 195, 199, 0.3);
    }
    
    .table thead {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
      color: white;
    }
    
    .table th {
      font-weight: 600;
      border: none;
      padding: 15px;
    }
    
    .table td {
      padding: 12px 15px;
      vertical-align: middle;
      border-color: rgba(189, 195, 199, 0.2);
    }
    
    .table tbody tr {
      transition: background 0.2s ease;
    }
    
    .table tbody tr:hover {
      background: rgba(236, 240, 241, 0.5);
    }
    
    .badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.85rem;
    }
    
    .badge.bg-primary {
      background: var(--secondary) !important;
    }
    
    .badge.bg-info {
      background: var(--info) !important;
    }
    
    .badge.bg-success {
      background: var(--success) !important;
    }
    
    .badge.bg-warning {
      background: var(--warning) !important;
    }
    
    .badge.bg-secondary {
      background: var(--gray) !important;
    }
    
    .modal-content {
      border-radius: 16px;
      border: 1px solid rgba(189, 195, 199, 0.3);
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(44, 62, 80, 0.15);
    }
    
    .modal-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      border: none;
      padding: 20px;
    }
    
    .form-control, .form-select {
      border-radius: 10px;
      border: 2px solid var(--gray-light);
      padding: 12px 15px;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    
    .btn-group-sm .btn {
      border-radius: 8px;
      margin: 0 2px;
      padding: 5px 10px;
    }
    
    .search-box {
      position: relative;
      margin-bottom: 20px;
    }
    
    .search-box input {
      padding-left: 45px;
      border-radius: 10px;
      border: 2px solid var(--gray-light);
    }
    
    .search-box i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
    }
    
    .academic-nav {
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 3px 10px rgba(44, 62, 80, 0.05);
      border: 1px solid rgba(189, 195, 199, 0.2);
    }
    
    .academic-nav .list-group-item {
      border: 1px solid rgba(189, 195, 199, 0.3);
      border-radius: 8px;
      margin-bottom: 8px;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    .academic-nav .list-group-item:hover {
      background: rgba(52, 152, 219, 0.08);
      color: var(--secondary);
      border-color: var(--secondary-light);
    }
    
    .academic-nav .list-group-item.active {
      background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
      color: white;
      border-color: var(--secondary);
    }
    
    .book-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(189, 195, 199, 0.2);
      box-shadow: 0 4px 12px rgba(44, 62, 80, 0.08);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(44, 62, 80, 0.12);
    }
    
    .audio-player {
      background: var(--light);
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
    }
    
    .audio-player audio {
      width: 100%;
      border-radius: 8px;
    }
    
    .book-cover {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--gray);
    }
    
    .loading i {
      font-size: 2rem;
      margin-bottom: 10px;
      color: var(--secondary);
    }
    
    .alert-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      min-width: 300px;
      max-width: 400px;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(44, 62, 80, 0.15);
      border: none;
    }
    
    .alert-notification.show {
      opacity: 1;
      transform: translateX(0);
    }
    
    .alert-success {
      background: var(--success);
      color: white;
      border-left: 4px solid #27ae60;
    }
    
    .alert-danger {
      background: var(--danger);
      color: white;
      border-left: 4px solid #c0392b;
    }
    
    .alert-warning {
      background: var(--warning);
      color: white;
      border-left: 4px solid #e67e22;
    }
    
    .alert-info {
      background: var(--info);
      color: white;
      border-left: 4px solid #2980b9;
    }
    
    .btn-close-white {
      filter: invert(1) grayscale(100%) brightness(200%);
    }
    
    .text-muted {
      color: var(--gray) !important;
    }
    
    .btn-outline-danger {
      color: var(--danger);
      border-color: var(--danger);
    }
    
    .btn-outline-danger:hover {
      background: var(--danger);
      border-color: var(--danger);
    }
    
    .btn-outline-info {
      color: var(--info);
      border-color: var(--info);
    }
    
    .btn-outline-info:hover {
      background: var(--info);
      border-color: var(--info);
    }
    
    /* Personnalisation de la scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--light);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--gray-light);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--gray);
    }
    
    /* Effets de survol pour les boutons d'action */
    .btn-outline-primary, .btn-outline-info, .btn-outline-danger {
      transition: all 0.2s ease;
    }
    
    .btn-outline-primary:hover, .btn-outline-info:hover, .btn-outline-danger:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    /* Am√©lioration des ombres */
    .card, .sidebar, .main-container, .navbar, .book-card {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    }
    
    /* Animation pour les ic√¥nes */
    .bi {
      transition: transform 0.2s ease;
    }
    
    .btn:hover .bi {
      transform: scale(1.1);
    }
    
    /* Style pour les badges dans les tableaux */
    .table .badge {
      font-size: 0.75rem;
      padding: 4px 10px;
    }
    
    /* Footer */
    .footer {
      background: var(--primary);
      color: white;
      padding: 40px 0 20px;
      margin-top: auto;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
    }
    
    .footer h5 {
      color: white;
      margin-bottom: 20px;
      font-weight: 600;
    }
    
    .footer-links {
      list-style: none;
      padding: 0;
    }
    
    .footer-links li {
      margin-bottom: 10px;
    }
    
    .footer-links a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .footer-links a:hover {
      color: white;
      padding-left: 5px;
    }
    
    .social-icons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }
    
    .social-icons a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      color: white;
      font-size: 1.2rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .social-icons a::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      transform: translate(-50%, -50%);
      transition: width 0.3s, height 0.3s;
    }
    
    .social-icons a:hover::after {
      width: 100%;
      height: 100%;
    }
    
    .social-icons a:hover {
      background: var(--secondary);
      transform: translateY(-3px);
    }
    
    /* Effet de lueur qui suit la souris */
    .glow-effect {
      position: relative;
      overflow: hidden;
    }
    .glow-effect::before {
      content: '';
      position: absolute;
      top: var(--y, 0);
      left: var(--x, 0);
      width: 200px;
      height: 200px;
      background: radial-gradient(circle at center, rgba(255,255,255,0.8), transparent 70%);
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
      transform: translate(-50%, -50%);
      z-index: 1;
    }
    .glow-effect:hover::before {
      opacity: 0.3;
    }
    
    .copyright {
      text-align: center;
      padding-top: 20px;
      margin-top: 30px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .main-container {
        padding: 15px;
        margin: 0 10px 15px 10px;
        border-radius: 12px;
      }
      
      .navbar {
        margin: 0 10px 15px 10px;
        padding: 10px 15px;
        border-radius: 10px;
      }
      
      .stat-card h2 {
        font-size: 1.75rem;
      }
      
      .footer {
        padding: 20px 15px 15px;
      }

      body {
        font-size: 14px;
      }

      input, select, textarea, button {
        font-size: 15px;
        min-height: 44px;
      }

      .col-lg-2, .col-md-3 {
        margin-bottom: 1rem;
      }
    }

    /* Tr√®s petits √©crans (320px - 479px) */
    @media (max-width: 479px) {
      body {
        font-size: 13px;
        overflow-x: hidden;
      }

      .main-container {
        padding: 10px;
        margin: 0 5px 10px 5px;
        border-radius: 10px;
      }

      .navbar {
        margin: 0 5px 10px 5px;
        padding: 8px 10px;
        border-radius: 8px;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .navbar h1, .navbar-brand {
        font-size: 1rem;
      }

      .d-flex {
        flex-direction: column;
        gap: 0.5rem;
      }

      /* Keep navbar items horizontal on very small screens */
      .navbar .d-flex {
        flex-direction: row !important;
        gap: 0 !important;
        align-items: center !important;
      }

      .stat-card {
        padding: 0.75rem;
        margin-bottom: 0.75rem;
        border-radius: 8px;
      }

      .stat-card h2 {
        font-size: 1.2rem;
      }

      .stat-card .stat-value {
        font-size: 1rem;
      }

      h1 { font-size: 1.2rem; }
      h2 { font-size: 1.1rem; }
      h3, h4 { font-size: 0.95rem; }

      .form-label {
        font-size: 0.85rem;
        margin-bottom: 0.25rem;
      }

      input[type="text"],
      input[type="email"],
      input[type="tel"],
      input[type="date"],
      input[type="number"],
      select,
      textarea {
        font-size: 16px;
        padding: 0.75rem;
        width: 100%;
        border-radius: 6px;
        min-height: 44px;
      }

      button, .btn {
        padding: 0.75rem;
        font-size: 0.9rem;
        width: 100%;
        border-radius: 6px;
        min-height: 44px;
      }

      .row {
        margin: 0;
        gap: 0.5rem;
      }

      [class*="col-"] {
        padding: 0.25rem;
        margin-bottom: 0.5rem;
      }

      .col-md-4, .col-lg-2, .col-lg-10 {
        width: 100%;
      }

      table {
        font-size: 0.7rem;
      }

      table th, table td {
        padding: 0.35rem;
      }

      .modal-dialog {
        margin: 0.5rem;
        width: 95%;
        max-width: 95%;
      }

      .modal-content {
        border-radius: 8px;
      }

      .modal-body {
        padding: 0.75rem;
      }

      .modal-header, .modal-footer {
        padding: 0.5rem;
      }

      .alert-notification {
        max-width: 95%;
        right: 5px;
        left: 5px;
        font-size: 0.8rem;
        padding: 0.75rem;
        border-radius: 6px;
      }

      .footer {
        padding: 15px 10px 10px;
        font-size: 0.75rem;
      }

      .footer h5 {
        font-size: 0.9rem;
      }

      .footer ul li {
        font-size: 0.75rem;
      }

      .card {
        border-radius: 8px;
        margin-bottom: 0.75rem;
      }

      .card-header {
        padding: 0.5rem;
        font-size: 0.9rem;
      }

      .card-body {
        padding: 0.5rem;
      }

      .badge {
        font-size: 0.65rem;
        padding: 0.25em 0.4em;
      }

      .sidebar {
        padding: 15px;
      }

      .sidebar .list-group-item {
        padding: 0.75rem;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
      }

      .sidebar .list-group-item.active {
        padding: 0.75rem;
      }
    }

    /* Petites tablettes (480px - 767px) */
    @media (min-width: 480px) and (max-width: 767px) {
      body {
        font-size: 14px;
      }

      .main-container {
        padding: 12px;
        margin: 0 8px 12px 8px;
      }

      .navbar {
        margin: 0 8px 12px 8px;
        padding: 10px 12px;
      }

      .stat-card {
        padding: 1rem;
        font-size: 0.95rem;
      }

      input, select, textarea, button {
        font-size: 14px;
        min-height: 44px;
      }

      table {
        font-size: 0.85rem;
      }

      .col-md-4 {
        width: 50%;
      }

      h1 { font-size: 1.3rem; }
      h2 { font-size: 1.1rem; }
    }

    /* Tablettes moyennes (768px - 1023px) */
    @media (min-width: 768px) and (max-width: 1023px) {
      .main-container {
        padding: 20px;
      }

      .navbar {
        padding: 12px 20px;
      }

      .col-md-3 {
        width: 30%;
      }

      .col-md-4 {
        width: 50%;
      }
    }

    /* √âcrans larges (1024px+) */
    @media (min-width: 1024px) {
      .main-container {
        padding: 30px;
      }

      .col-lg-2 {
        width: 16.66%;
      }

      .col-lg-10 {
        width: 83.33%;
      }
    }

    /* Password toggle styles */
    .password-input-container {
        position: relative;
    }

    .password-toggle-btn {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: #999;
        font-size: 16px;
        padding: 4px 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: color 0.2s;
    }

    .password-toggle-btn:hover {
        color: #667eea;
    }

    .password-input-container input {
        padding-right: 40px !important;
    }

    /* Carousel pour contacts */
    .contact-carousel {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    .contact-carousel-item {
      display: none;
    }
    .contact-carousel-item.active {
      display: block;
    }
    .contact-carousel-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    .contact-carousel-controls button {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      border-radius: 50%;
      width: 30px;
      height: 30px;
    }
    .settings-icon {
      cursor: pointer;
      font-size: 1.2rem;
      margin-left: 10px;
    }
  </style>
  <script src="password-visibility.js"></script>
</head>
<body>
  <!-- Notification -->
  <div id="notification" class="alert-notification alert" role="alert" style="display: none;">
    <div class="d-flex justify-content-between align-items-start">
      <div>
        <strong id="notification-title"></strong>
        <div id="notification-message"></div>
      </div>
      <button type="button" class="btn-close btn-close-white" onclick="hideNotification()"></button>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="#" style="display: flex; align-items: center; gap: 10px;">
        <img src="asset/img/logo_eden.png" alt="Logo Eden Family School" style="height: 40px; width: auto; object-fit: contain;">
        Eden Family School
      </a>
      <div class="d-flex align-items-center">
        <span class="me-3 text-muted" id="currentUserDisplay">
          <i class="bi bi-person-circle me-1"></i>
          <span id="currentUser">Chargement...</span>
        </span>
        <button class="btn btn-outline-primary btn-sm me-2" onclick="toggleLanguage()">
          <i class="bi bi-translate"></i> FR/EN
        </button>
        <i class="bi bi-gear-fill settings-icon" onclick="openSettings()" title="Param√®tres"></i>
        <button class="btn btn-outline-danger btn-sm ms-2" onclick="logout()">
          <i class="bi bi-box-arrow-right me-1"></i> D√©connexion
        </button>
      </div>
    </div>
  </nav>

  <div class="main-container">
    <div class="row">
      <!-- Sidebar (navigation uniquement, sans statistiques) -->
      <div class="col-lg-2 col-md-3 mb-4">
        <div class="sidebar">
          <div class="list-group">
            <a href="#home" class="list-group-item active" data-section="home" onclick="switchSection('home')">
              <i class="bi bi-house-door-fill me-2"></i> Accueil
            </a>
            <a href="#students" class="list-group-item" data-section="students" onclick="switchSection('students')">
              <i class="bi bi-people-fill me-2"></i> √âl√®ves
            </a>
            <a href="#inscription" class="list-group-item" data-section="inscription" onclick="switchSection('inscription')">
              <i class="bi bi-pen-fill me-2"></i> Inscription
            </a>
            <a href="#teachers" class="list-group-item" data-section="teachers" onclick="switchSection('teachers')">
              <i class="bi bi-person-badge-fill me-2"></i> Enseignants
            </a>
            <a href="#academic" class="list-group-item" data-section="academic" onclick="switchSection('academic')">
              <i class="bi bi-journal-text me-2"></i> Acad√©mique
            </a>
            <a href="#library" class="list-group-item" data-section="library" onclick="switchSection('library')">
              <i class="bi bi-book-fill me-2"></i> Biblioth√®que
            </a>
            <a href="#messages" class="list-group-item" data-section="messages" onclick="switchSection('messages')">
              <i class="bi bi-envelope-fill me-2"></i> Messages
            </a>
            <a href="#activities" class="list-group-item" data-section="activities" onclick="switchSection('activities')">
              <i class="bi bi-activity me-2"></i> Activit√©s
            </a>
            <a href="#users" class="list-group-item" data-section="users" onclick="switchSection('users')">
              <i class="bi bi-person-gear me-2"></i> Gestion des Utilisateurs
            </a>
          </div>
        </div>
        <!-- Les statistiques ont √©t√© retir√©es d'ici -->
      </div>

      <!-- Main Content -->
      <div class="col-lg-10 col-md-9">
        <!-- Section Accueil (avec toutes les statistiques) -->
        <div id="section-home" class="content-section" style="display: block;">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0"><i class="bi bi-house-door-fill me-2"></i>Tableau de bord</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4">
                  <div class="stat-card students" onclick="switchSection('students')">
                    <i class="bi bi-people-fill"></i>
                    <h2 id="homeStatsStudents">0</h2>
                    <small>√âl√®ves actifs</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="stat-card" onclick="switchSection('inscription')">
                    <i class="bi bi-pen-fill"></i>
                    <h2 id="homeStatsInscriptions">0</h2>
                    <small>Inscriptions</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="stat-card teachers" onclick="switchSection('teachers')">
                    <i class="bi bi-person-badge-fill"></i>
                    <h2 id="homeStatsTeachers">0</h2>
                    <small>Enseignants</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="stat-card assignments" onclick="switchSection('academic')">
                    <i class="bi bi-journal-text"></i>
                    <h2 id="homeStatsAssignments">0</h2>
                    <small>Devoirs</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="stat-card books" onclick="switchSection('library')">
                    <i class="bi bi-book-fill"></i>
                    <h2 id="homeStatsBooks">0</h2>
                    <small>Livres</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="stat-card" onclick="switchSection('messages')">
                    <i class="bi bi-envelope-fill"></i>
                    <h2 id="homeStatsMessages">0</h2>
                    <small>Messages non lus</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Inscription -->
        <div id="section-inscription" class="content-section" style="display: none;">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="bi bi-pen-fill me-2"></i>Formulaire d'Inscription Scolaire</h5>
            </div>
            <div class="card-body">
              <form id="inscriptionFormSecretary" style="max-width: 900px; margin: 0 auto;">
                <!-- Info Enfant -->
                <div style="background: #E8EAF6; padding: 1rem; margin: 1.5rem 0 1rem; border-radius: 8px; font-weight: bold; color: var(--dark);">INFORMATION DE L'ENFANT</div>
                
                <div class="row">
                  <div class="col-md-4 mb-3">
                    <label class="form-label"><i class="bi bi-person-fill"></i> Nom et pr√©nom *</label>
                    <input type="text" id="nomPrenomSec" name="nomPrenom" class="form-control" required>
                    <div id="nomPrenomErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <label class="form-label"><i class="bi bi-calendar-event"></i> Date de naissance *</label>
                    <input type="date" id="dateNaissanceSec" name="dateNaissance" class="form-control" required>
                    <div id="dateNaissanceErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <label class="form-label"><i class="bi bi-building"></i> √âcole de provenance *</label>
                    <input type="text" id="ecoleProvenanceSec" name="ecoleProvenance" class="form-control" required>
                    <div id="ecoleProvenanceErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                </div>

                <!-- Sexe -->
                <div class="mb-3">
                  <label class="form-label"><i class="bi bi-gender-ambiguous"></i> Sexe *</label>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="garconSec" name="sexe" value="GAR√áON" required>
                    <label class="form-check-label" for="garconSec">
                      <i class="bi bi-person-fill"></i> GAR√áON
                    </label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="filleSec" name="sexe" value="FILLE" required>
                    <label class="form-check-label" for="filleSec">
                      <i class="bi bi-person-fill"></i> FILLE
                    </label>
                  </div>
                  <div id="sexeErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                </div>

                <!-- Niveau Scolaire -->
                <div style="background: #E8EAF6; padding: 1rem; margin: 1.5rem 0 1rem; border-radius: 8px; font-weight: bold; color: var(--dark);">NIVEAU SCOLAIRE</div>
                
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label"><i class="bi bi-mortarboard"></i> Section *</label>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" id="maternelleSec" name="section" value="MATERNELLE" required onchange="updateSectionSec()">
                      <label class="form-check-label" for="maternelleSec">
                        MATERNELLE
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" id="primaireSec" name="section" value="PRIMAIRE" required onchange="updateSectionSec()">
                      <label class="form-check-label" for="primaireSec">
                        PRIMAIRE
                      </label>
                    </div>
                    <div id="sectionErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  
                  <div class="col-md-6 mb-3" id="niveauMaternelleGroupSec" style="display: none;">
                    <label class="form-label"><i class="bi bi-star-fill"></i> Niveau maternelle *</label>
                    <select id="niveauMaternelleSec" name="niveauMaternelle" class="form-control">
                      <option value="">S√©lectionnez</option>
                      <option value="N1">N1</option>
                      <option value="N2">N2</option>
                      <option value="N3">N3</option>
                    </select>
                    <div id="niveauMaternelleErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  
                  <div class="col-md-6 mb-3" id="niveauPrimaireGroupSec" style="display: none;">
                    <label class="form-label"><i class="bi bi-book-fill"></i> Niveau primaire *</label>
                    <select id="niveauPrimaireSec" name="niveauPrimaire" class="form-control">
                      <option value="">S√©lectionnez</option>
                      <option value="P1">P1</option>
                      <option value="P2">P2</option>
                      <option value="P3">P3</option>
                      <option value="P4">P4</option>
                      <option value="P5">P5</option>
                    </select>
                    <div id="niveauPrimaireErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  
                  <div class="col-md-6 mb-3" id="sdmsGroupSec" style="display: none;">
                    <label class="form-label"><i class="bi bi-card-text"></i> SDMS Code (Obligatoire) *</label>
                    <input type="text" id="sdmsCodeSec" name="sdmsCode" class="form-control" placeholder="Code SDMS">
                    <div id="sdmsCodeErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                </div>

                <!-- Branche -->
                <div style="background: #E8EAF6; padding: 1rem; margin: 1.5rem 0 1rem; border-radius: 8px; font-weight: bold; color: var(--dark);">BRANCHE</div>
                
                <div class="mb-3">
                  <label class="form-label"><i class="bi bi-building"></i> S√©lectionnez la branche *</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="brancheKacyiruSec" name="branche" value="KACYIRU" required onchange="updateContactInfoSec()">
                    <label class="form-check-label" for="brancheKacyiruSec">
                      KACYIRU
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="brancheGisoziSec" name="branche" value="GISOZI" required onchange="updateContactInfoSec()">
                    <label class="form-check-label" for="brancheGisoziSec">
                      GISOZI
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="brancheKimisagaraSec" name="branche" value="KIMISAGARA" required onchange="updateContactInfoSec()">
                    <label class="form-check-label" for="brancheKimisagaraSec">
                      KIMISAGARA
                    </label>
                  </div>
                  <div id="brancheErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                </div>

                <!-- Contact Info -->
                <div id="contactInfoSec" style="background: #FFF9C4; padding: 1.5rem; border-radius: 10px; margin: 2rem 0; border-left: 5px solid #FFC107; text-align: center; display: none;">
                  <p id="contactTextSec"></p>
                </div>

                <!-- Transport -->
                <div style="background: #E8EAF6; padding: 1rem; margin: 1.5rem 0 1rem; border-radius: 8px; font-weight: bold; color: var(--dark);">TRANSPORT</div>
                
                <div class="mb-3">
                  <label class="form-label"><i class="bi bi-bus-front"></i> Transport bus *</label>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="transportOuiSec" name="transport" value="OUI" required>
                    <label class="form-check-label" for="transportOuiSec">
                      OUI
                    </label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="transportNonSec" name="transport" value="NON" required>
                    <label class="form-check-label" for="transportNonSec">
                      NON
                    </label>
                  </div>
                  <div id="transportErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                </div>

                <!-- Chef de Famille -->
                <div style="background: #E8EAF6; padding: 1rem; margin: 1.5rem 0 1rem; border-radius: 8px; font-weight: bold; color: var(--dark);">CHEF DE FAMILLE</div>
                
                <div class="row">
                  <div class="col-md-4 mb-3">
                    <label class="form-label"><i class="bi bi-person-fill"></i> Nom et pr√©nom *</label>
                    <input type="text" id="chefNomPrenomSec" name="chefNomPrenom" class="form-control" required>
                    <div id="chefNomPrenomErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <label class="form-label"><i class="bi bi-telephone"></i> T√©l√©phone *</label>
                    <input type="tel" id="chefTelephoneSec" name="chefTelephone" pattern="[0-9]{10}" class="form-control" required>
                    <div id="chefTelephoneErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <label class="form-label"><i class="bi bi-card-text"></i> Pi√®ce d'identit√© *</label>
                    <input type="text" id="chefPieceIdentiteSec" name="chefPieceIdentite" class="form-control" required>
                    <div id="chefPieceIdentiteErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                </div>

                <!-- Conjoint (Optionnel) -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1rem; margin: 1.5rem 0 1rem; border-radius: 8px; font-weight: bold; color: white;">CONJOINT(E) (Optionnel)</div>
                
                <div class="row">
                  <div class="col-md-4 mb-3">
                    <label class="form-label"><i class="bi bi-person-fill"></i> Nom et pr√©nom</label>
                    <input type="text" id="conjointNomPrenomSec" name="conjointNomPrenom" class="form-control">
                  </div>
                  <div class="col-md-4 mb-3">
                    <label class="form-label"><i class="bi bi-telephone"></i> T√©l√©phone</label>
                    <input type="tel" id="conjointTelephoneSec" name="conjointTelephone" pattern="[0-9]{10}" class="form-control">
                  </div>
                  <div class="col-md-4 mb-3">
                    <label class="form-label"><i class="bi bi-card-text"></i> Pi√®ce d'identit√©</label>
                    <input type="text" id="conjointPieceIdentiteSec" name="conjointPieceIdentite" class="form-control">
                  </div>
                </div>

                <!-- Adresse -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1rem; margin: 1.5rem 0 1rem; border-radius: 8px; font-weight: bold; color: white;">ADRESSE</div>
                
                <div class="row">
                  <div class="col-md-3 mb-3">
                    <label class="form-label"><i class="bi bi-geo-alt"></i> Ville *</label>
                    <select id="villeSec" name="ville" class="form-control" required>
                      <option value="">S√©lectionnez</option>
                      <option value="Kigali">Kigali</option>
                      <option value="Butare">Butare</option>
                      <option value="Gisenyi">Gisenyi</option>
                      <option value="Ruhengeri">Ruhengeri</option>
                      <option value="Gitarama">Gitarama</option>
                      <option value="Kibungo">Kibungo</option>
                    </select>
                    <div id="villeErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <label class="form-label"><i class="bi bi-map"></i> Secteur *</label>
                    <input type="text" id="secteurSec" name="secteur" class="form-control" required>
                    <div id="secteurErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <label class="form-label"><i class="bi bi-signpost-2"></i> Umurenge *</label>
                    <input type="text" id="umurengeSec" name="umurenge" class="form-control" required>
                    <div id="umurengeErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <label class="form-label"><i class="bi bi-house"></i> Akagari *</label>
                    <input type="text" id="akagariSec" name="akagari" class="form-control" required>
                    <div id="akagariErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <label class="form-label"><i class="bi bi-street-view"></i> Umudugudu *</label>
                    <input type="text" id="umuduguduSec" name="umudugudu" class="form-control" required>
                    <div id="umuduguduErrorSec" style="color: var(--danger); font-size: 0.85em; margin-top: 0.3rem; display: none;"></div>
                  </div>
                </div>

                <!-- Bouton -->
                <div class="text-center mt-4">
                  <button type="button" class="btn btn-primary btn-lg" onclick="submitSecretaryInscription()">
                    <i class="bi bi-send"></i> Soumettre l'inscription
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Section √âl√®ves -->
        <div id="section-students" class="content-section" style="display: none;">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="bi bi-people-fill me-2"></i>Gestion des √âl√®ves</h5>
              <button class="btn btn-light btn-sm" onclick="openAddStudentModal()">
                <i class="bi bi-plus-circle me-1"></i> Nouvel √âl√®ve
              </button>
            </div>
            <div class="card-body">
              <div class="d-flex align-items-center gap-2 mb-3">
                <div class="search-box flex-grow-1">
                  <i class="bi bi-search"></i>
                  <input type="text" class="form-control" id="searchStudent" placeholder="Rechercher un √©l√®ve..." oninput="filterStudents()">
                </div>
                <select id="classFilter" class="form-control" onchange="filterStudents()">
                  <option value="">Toutes les classes</option>
                </select>
              </div>
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead>
                    <tr>
                      <th><i class="bi bi-person me-1"></i>Nom Complet</th>
                      <th><i class="bi bi-building me-1"></i>Classe</th>
                      <th><i class="bi bi-gender-ambiguous me-1"></i>Sexe</th>
                      <th><i class="bi bi-people me-1"></i>Parent</th>
                      <th><i class="bi bi-telephone me-1"></i>T√©l√©phone</th>
                      <th><i class="bi bi-calendar me-1"></i>Date Ajout</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="studentsTable">
                    <!-- Les √©l√®ves seront charg√©s ici -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Gestion des Utilisateurs -->
        <div id="section-users" class="content-section" style="display: none;">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="bi bi-person-gear me-2"></i>Gestion des Utilisateurs</h5>
              <button class="btn btn-light btn-sm" onclick="openAddUserModal()">
                <i class="bi bi-plus-circle me-1"></i> Nouvel Utilisateur
              </button>
            </div>
            <div class="card-body">
              <div class="search-box mb-3">
                <i class="bi bi-search"></i>
                <input type="text" class="form-control" id="searchUser" placeholder="Rechercher un utilisateur..." oninput="filterUsers()">
              </div>
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead>
                    <tr>
                      <th><i class="bi bi-person me-1"></i>Nom d'utilisateur</th>
                      <th><i class="bi bi-envelope me-1"></i>Email</th>
                      <th><i class="bi bi-shield-lock me-1"></i>Role</th>
                      <th><i class="bi bi-check-circle me-1"></i>Statut</th>
                      <th><i class="bi bi-calendar me-1"></i>Date Creation</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="usersTable">
                    <!-- Les utilisateurs seront charges ici -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Enseignants -->
        <div id="section-teachers" class="content-section" style="display: none;">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="bi bi-person-badge-fill me-2"></i>Gestion des Enseignants</h5>
              <button class="btn btn-light btn-sm" onclick="openAddTeacherModal()">
                <i class="bi bi-plus-circle me-1"></i> Nouvel Enseignant
              </button>
            </div>
            <div class="card-body">
              <div class="search-box">
                <i class="bi bi-search"></i>
                <input type="text" class="form-control" id="searchTeacher" placeholder="Rechercher un enseignant..." oninput="filterTeachers()">
              </div>
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead>
                    <tr>
                      <th><i class="bi bi-person me-1"></i>Nom</th>
                      <th><i class="bi bi-envelope me-1"></i>Email</th>
                      <th><i class="bi bi-telephone me-1"></i>T√©l√©phone</th>
                      <th><i class="bi bi-book me-1"></i>Mati√®re/Classe</th>
                      <th><i class="bi bi-people-fill me-1"></i>√âl√®ves</th>
                      <th><i class="bi bi-check-circle me-1"></i>Statut</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="teachersTable">
                    <!-- Les enseignants seront charg√©s ici -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Acad√©mique -->
        <div id="section-academic" class="content-section" style="display: none;">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0"><i class="bi bi-journal-text me-2"></i>Gestion Acad√©mique</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-3">
                  <div class="academic-nav list-group">
                    <a href="#assignments" class="list-group-item active" onclick="switchAcademic('assignments')">
                      <i class="bi bi-clipboard-check me-2"></i>Devoirs
                    </a>
                    <a href="#tests" class="list-group-item" onclick="switchAcademic('tests')">
                      <i class="bi bi-file-text me-2"></i>Tests
                    </a>
                    <a href="#exams" class="list-group-item" onclick="switchAcademic('exams')">
                      <i class="bi bi-pen me-2"></i>Examens
                    </a>
                    <a href="#vacation" class="list-group-item" onclick="switchAcademic('vacation')">
                      <i class="bi bi-sun me-2"></i>Travaux Vacances
                    </a>
                    <a href="#reports" class="list-group-item" onclick="switchAcademic('reports')">
                      <i class="bi bi-file-pdf me-2"></i>Bulletins
                    </a>
                    <a href="#classes" class="list-group-item" onclick="switchAcademic('classes')">
                      <i class="bi bi-building me-2"></i>Classes
                    </a>
                  </div>
                </div>
                <div class="col-md-9">
                  <div id="academic-assignments" class="academic-content">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h6 class="mb-0"><i class="bi bi-clipboard-check me-2"></i>Gestion des Devoirs</h6>
                      <button class="btn btn-primary btn-sm" onclick="openAddAssignmentModal()">
                        <i class="bi bi-plus-circle me-1"></i> Ajouter un devoir
                      </button>
                    </div>
                    <div id="assignmentsList"></div>
                  </div>
                  <div id="academic-tests" class="academic-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h6 class="mb-0"><i class="bi bi-file-text me-2"></i>Gestion des Tests</h6>
                      <button class="btn btn-primary btn-sm" onclick="openAddTestModal()">
                        <i class="bi bi-plus-circle me-1"></i> Ajouter un test
                      </button>
                    </div>
                    <div id="testsList"></div>
                  </div>
                  <div id="academic-exams" class="academic-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h6 class="mb-0"><i class="bi bi-pen me-2"></i>Gestion des Examens</h6>
                      <button class="btn btn-primary btn-sm" onclick="openAddExamModal()">
                        <i class="bi bi-plus-circle me-1"></i> Ajouter un examen
                      </button>
                    </div>
                    <div id="examsList"></div>
                  </div>
                  <div id="academic-vacation" class="academic-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h6 class="mb-0"><i class="bi bi-sun me-2"></i>Travaux de Vacances</h6>
                      <button class="btn btn-primary btn-sm" onclick="openAddVacationWorkModal()">
                        <i class="bi bi-plus-circle me-1"></i> Ajouter un travail
                      </button>
                    </div>
                    <div id="vacationList"></div>
                  </div>
                  <div id="academic-reports" class="academic-content" style="display: none;">
                    <h6 class="mb-3"><i class="bi bi-file-pdf me-2"></i>Bulletins Scolaires</h6>
                    <div class="row mb-3">
                      <div class="col-md-3">
                        <select class="form-select" id="reportTypeSelect">
                          <option value="academic">Acad√©mique</option>
                          <option value="conduct">Conduite</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <select class="form-select" id="reportClassSelect" onchange="loadTeachersForClass()">
                          <option value="">Choisir une classe</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <select class="form-select" id="reportTeacherSelect" onchange="loadStudentsForTeacher()">
                          <option value="">Choisir un enseignant</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <select class="form-select" id="reportStudentSelect" onchange="loadReportsForStudent()">
                          <option value="">Choisir un √©l√®ve</option>
                        </select>
                      </div>
                    </div>
                    <div class="row mb-3">
                      <div class="col-md-12">
                        <button class="btn btn-secondary" onclick="sendMissingReportAlert()">Alerter enseignant pour bulletins manquants</button>
                      </div>
                    </div>
                    <div id="reportsList" class="row"></div>
                    <div id="studentProfile" class="mt-3 p-3 border rounded" style="display: none;"></div>
                  </div>
                  <div id="academic-classes" class="academic-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h6 class="mb-0"><i class="bi bi-building me-2"></i>Gestion des Classes</h6>
                      <button class="btn btn-primary btn-sm" onclick="openAddClassModal()">
                        <i class="bi bi-plus-circle me-1"></i> Cr√©er une classe
                      </button>
                    </div>
                    <div class="row">
                      <div class="col-md-5">
                        <div class="card">
                          <div class="card-header">
                            <h6 class="mb-0">Classes disponibles</h6>
                          </div>
                          <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                            <div id="classesList"></div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-7">
                        <div class="card">
                          <div class="card-header">
                            <h6 class="mb-0">√âl√®ves de la classe : <span id="selectedClassName" class="badge bg-primary">--</span></h6>
                          </div>
                          <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                            <div id="classStudentsList"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Biblioth√®que -->
        <div id="section-library" class="content-section" style="display: none;">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="bi bi-book-fill me-2"></i>Biblioth√®que en Ligne</h5>
              <div class="btn-group">
                <button class="btn btn-light btn-sm" onclick="openAddBookModal()">
                  <i class="bi bi-plus-circle me-1"></i> Ajouter un Livre
                </button>
                <button class="btn btn-light btn-sm" onclick="openAddAudioBookModal()">
                  <i class="bi bi-headphones me-1"></i> Ajouter un Livre Audio
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="row mb-4">
                <div class="col-md-6">
                  <div class="search-box">
                    <i class="bi bi-search"></i>
                    <input type="text" class="form-control" id="searchBook" placeholder="Rechercher un livre..." oninput="filterBooks()">
                  </div>
                </div>
                <div class="col-md-6">
                  <select class="form-select" id="bookFilter" onchange="filterBooks()">
                    <option value="all">Tous les livres</option>
                    <option value="text">Livres texte</option>
                    <option value="audio">Livres audio</option>
                    <option value="available">Disponibles</option>
                  </select>
                </div>
              </div>
              
              <div class="row" id="libraryBooks">
                <!-- Les livres seront charg√©s ici -->
              </div>
            </div>
          </div>
        </div>

        <!-- Section Messages -->
        <div id="section-messages" class="content-section" style="display: none;">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="bi bi-envelope-fill me-2"></i>Messagerie</h5>
              <button class="btn btn-light btn-sm" onclick="openNewMessageModal()">
                <i class="bi bi-pencil-square me-1"></i> Nouveau message
              </button>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4">
                  <div class="list-group" id="conversationsList">
                    <!-- Liste des conversations (utilisateurs) -->
                  </div>
                </div>
                <div class="col-md-8">
                  <div id="messageThread" style="min-height: 300px; border: 1px solid #ddd; padding: 15px; border-radius: 10px; overflow-y: auto; max-height: 400px;">
                    S√©lectionnez une conversation
                  </div>
                  <div class="mt-3">
                    <textarea class="form-control" id="newMessageText" placeholder="√âcrire un message..."></textarea>
                    <button class="btn btn-primary mt-2" onclick="sendMessage()">Envoyer</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Activit√©s -->
        <div id="section-activities" class="content-section" style="display: none;">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0"><i class="bi bi-activity me-2"></i>Activit√©s r√©centes</h5>
            </div>
            <div class="card-body">
              <div id="activitiesList"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 col-md-6 mb-4">
          <h5>√Ä propos d'Eden Family School</h5>
          <p>Notre √©cole offre une √©ducation de qualit√© combinant excellence acad√©mique et d√©veloppement personnel. Nous nous engageons √† fournir un environnement d'apprentissage stimulant pour chaque √©l√®ve.</p>
          <div class="social-icons" id="socialIcons">
            <!-- Ic√¥nes avec effet de lueur -->
            <a href="#" class="glow-effect" data-social="whatsapp"><i class="fab fa-whatsapp"></i></a>
            <a href="#" class="glow-effect" data-social="facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="glow-effect" data-social="instagram"><i class="fab fa-instagram"></i></a>
            <a href="#" class="glow-effect" data-social="youtube"><i class="fab fa-youtube"></i></a>
          </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-4">
          <h5>Liens Rapides</h5>
          <ul class="footer-links">
            <li><a href="#students" onclick="switchSection('students')"><i class="bi bi-chevron-right me-1"></i> Gestion des √âl√®ves</a></li>
            <li><a href="#teachers" onclick="switchSection('teachers')"><i class="bi bi-chevron-right me-1"></i> Gestion des Enseignants</a></li>
            <li><a href="#academic" onclick="switchSection('academic')"><i class="bi bi-chevron-right me-1"></i> Section Acad√©mique</a></li>
            <li><a href="#library" onclick="switchSection('library')"><i class="bi bi-chevron-right me-1"></i> Biblioth√®que</a></li>
          </ul>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-4">
          <h5>Contact & Aide</h5>
          <div class="contact-carousel">
            <div class="contact-carousel-item active" id="contact-kimisagara">
              <strong>Kimisagara</strong><br>
              <em>√âcole maternelle</em><br>
              Maternelle<br>
              KG 7 Ave, Kimisagara, Kigali<br>
              Comptable: 0785892018 | Responsable: 0791826950<br>
              kimisagara@edenfamily.edu.rw<br>
              Lun-Ven: 7h30 - 17h30
            </div>
            <div class="contact-carousel-item" id="contact-gisozi">
              <strong>Gisozi</strong><br>
              <em>√âcole maternelle et primaire</em><br>
              Maternelle, Primaire<br>
              KG 11 Ave, Gisozi, Kigali<br>
              Directrice: 0788410242 | DOS: 0796145647 | DG: 0788883842<br>
              gisozi@edenfamily.edu.rw<br>
              Lun-Ven: 7h30 - 18h00
            </div>
            <div class="contact-carousel-item" id="contact-kacyiru">
              <strong>Kacyiru</strong><br>
              <em>√âcole maternelle</em><br>
              Maternelle<br>
              KG 17 Ave, Kacyiru, Kigali<br>
              Directeur: 0791639766 | Comptable: 0792570074<br>
              sergetumbwe@gmail.com<br>
              Lun-Ven: 7h30 - 17h30
            </div>
            <div class="contact-carousel-controls">
              <button onclick="prevContact()"><i class="bi bi-chevron-left"></i></button>
              <button onclick="nextContact()"><i class="bi bi-chevron-right"></i></button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="copyright">
        <p>&copy; 2024 Eden Family School. Tous droits r√©serv√©s.</p>
        <p>Portail Secr√©taire - Version 3.0</p>
      </div>
    </div>
  </footer>

  <!-- Modals -->
  <!-- Modal √âl√®ve -->
  <div class="modal fade" id="studentModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="studentModalTitle"><i class="bi bi-person-plus me-2"></i>Ajouter/Modifier √âl√®ve</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="studentForm">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label>Nom complet</label>
                <input type="text" class="form-control" id="studentName" required>
              </div>
              <div class="col-md-6 mb-3">
                <label>Classe</label>
                <select class="form-select" id="studentClass" required>
                  <option value="">S√©lectionner</option>
                  <!-- Options g√©n√©r√©es dynamiquement -->
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label>Sexe</label>
                <select class="form-select" id="studentGender">
                  <option value="Masculin">Masculin</option>
                  <option value="F√©minin">F√©minin</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label>Date de naissance</label>
                <input type="date" class="form-control" id="studentDob">
              </div>
              <div class="col-md-6 mb-3">
                <label>Parent</label>
                <input type="text" class="form-control" id="studentParent">
              </div>
              <div class="col-md-6 mb-3">
                <label>T√©l√©phone parent</label>
                <input type="tel" class="form-control" id="studentPhone">
              </div>
              <div class="col-md-6 mb-3">
                <label>Email parent</label>
                <input type="email" class="form-control" id="studentEmail">
              </div>
              <div class="col-md-6 mb-3">
                <label>Enseignant responsable</label>
                <select class="form-select" id="studentTeacher">
                  <option value="">Aucun</option>
                </select>
              </div>
            </div>
            <input type="hidden" id="studentId">
            <button type="submit" class="btn btn-primary">Enregistrer</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Enseignant -->
  <div class="modal fade" id="teacherModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="teacherModalTitle"><i class="bi bi-person-plus me-2"></i>Ajouter/Modifier Enseignant</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="teacherForm">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label>Nom complet</label>
                <input type="text" class="form-control" id="teacherName" required>
              </div>
              <div class="col-md-6 mb-3">
                <label>Email</label>
                <input type="email" class="form-control" id="teacherEmail" required>
              </div>
              <div class="col-md-6 mb-3">
                <label>T√©l√©phone</label>
                <input type="tel" class="form-control" id="teacherPhone" required>
              </div>
              <div class="col-md-6 mb-3">
                <label>Mati√®re enseign√©e</label>
                <input type="text" class="form-control" id="teacherSubject">
              </div>
              <div class="col-md-6 mb-3">
                <label>Classe(s) assign√©e(s)</label>
                <select class="form-select" id="teacherClasses" multiple>
                  <option value="">-- S√©lectionner les classes --</option>
                </select>
                <small class="form-text text-muted">Maintenez Ctrl/Cmd pour s√©lectionner plusieurs classes</small>
              </div>
              <div class="col-md-6 mb-3">
                <label>Statut</label>
                <select class="form-select" id="teacherStatus">
                  <option value="Actif">Actif</option>
                  <option value="Inactif">Inactif</option>
                </select>
              </div>
            </div>
            <input type="hidden" id="teacherId">
            <button type="submit" class="btn btn-primary">Enregistrer</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Devoir avec upload -->
  <div class="modal fade" id="assignmentModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="assignmentModalTitle"><i class="bi bi-clipboard-plus me-2"></i>Ajouter/Modifier Devoir</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="assignmentForm">
            <div class="row">
              <div class="col-md-8 mb-3">
                <label>Titre</label>
                <input type="text" class="form-control" id="assignmentTitle" required>
              </div>
              <div class="col-md-4 mb-3">
                <label>Classe</label>
                <select class="form-select" id="assignmentClass" required></select>
              </div>
              <div class="col-md-6 mb-3">
                <label>Mati√®re</label>
                <input type="text" class="form-control" id="assignmentSubject">
              </div>
              <div class="col-md-6 mb-3">
                <label>Date de remise</label>
                <input type="datetime-local" class="form-control" id="assignmentDueDate">
              </div>
              <div class="col-md-12 mb-3">
                <label>Description</label>
                <textarea class="form-control" id="assignmentDesc" rows="3"></textarea>
              </div>
              <div class="col-md-12 mb-3">
                <label>Fichier (PDF, image)</label>
                <input type="file" class="form-control" id="assignmentFile" accept=".pdf,.jpg,.jpeg,.png">
                <small class="text-muted">Laissez vide pour conserver le fichier existant.</small>
              </div>
            </div>
            <input type="hidden" id="assignmentId">
            <input type="hidden" id="assignmentFileUrl">
            <button type="submit" class="btn btn-primary">Enregistrer</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Livre avec upload -->
  <div class="modal fade" id="bookModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="bookModalTitle"><i class="bi bi-book-fill me-2"></i>Ajouter un Livre</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="bookForm">
            <div class="row">
              <div class="col-md-8 mb-3">
                <label>Titre</label>
                <input type="text" class="form-control" id="bookTitle" required>
              </div>
              <div class="col-md-4 mb-3">
                <label>Auteur</label>
                <input type="text" class="form-control" id="bookAuthor" required>
              </div>
              <div class="col-md-6 mb-3">
                <label>Cat√©gorie</label>
                <input type="text" class="form-control" id="bookCategory">
              </div>
              <div class="col-md-6 mb-3">
                <label>Classe cible</label>
                <select class="form-select" id="bookClass">
                  <option value="Toutes">Toutes</option>
                </select>
              </div>
              <div class="col-md-12 mb-3">
                <label>Description</label>
                <textarea class="form-control" id="bookDescription" rows="3"></textarea>
              </div>
              <div class="col-md-12 mb-3">
                <label>Fichier du livre (PDF)</label>
                <input type="file" class="form-control" id="bookFile" accept=".pdf">
              </div>
              <div class="col-md-12 mb-3">
                <label>Image de couverture (optionnel)</label>
                <input type="file" class="form-control" id="bookCoverFile" accept=".jpg,.jpeg,.png">
              </div>
            </div>
            <input type="hidden" id="bookId">
            <input type="hidden" id="bookType" value="text">
            <button type="submit" class="btn btn-primary">Enregistrer</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Livre Audio (similaire, on peut le fusionner) -->
  <div class="modal fade" id="audioBookModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="audioBookModalTitle"><i class="bi bi-headphones me-2"></i>Ajouter un Livre Audio</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="audioBookForm">
            <div class="row">
              <div class="col-md-8 mb-3">
                <label>Titre</label>
                <input type="text" class="form-control" id="audioBookTitle" required>
              </div>
              <div class="col-md-4 mb-3">
                <label>Auteur/Narrateur</label>
                <input type="text" class="form-control" id="audioBookAuthor" required>
              </div>
              <div class="col-md-6 mb-3">
                <label>Cat√©gorie</label>
                <input type="text" class="form-control" id="audioBookCategory">
              </div>
              <div class="col-md-6 mb-3">
                <label>Classe cible</label>
                <select class="form-select" id="audioBookClass">
                  <option value="Toutes">Toutes</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label>Dur√©e (minutes)</label>
                <input type="number" class="form-control" id="audioBookDuration">
              </div>
              <div class="col-md-12 mb-3">
                <label>Description</label>
                <textarea class="form-control" id="audioBookDescription" rows="3"></textarea>
              </div>
              <div class="col-md-12 mb-3">
                <label>Fichier audio (MP3)</label>
                <input type="file" class="form-control" id="audioBookFile" accept=".mp3,.wav">
              </div>
              <div class="col-md-12 mb-3">
                <label>Image de couverture (optionnel)</label>
                <input type="file" class="form-control" id="audioBookCoverFile" accept=".jpg,.jpeg,.png">
              </div>
            </div>
            <input type="hidden" id="audioBookId">
            <input type="hidden" id="audioBookType" value="audio">
            <button type="submit" class="btn btn-primary">Enregistrer</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Nouveau message -->
  <div class="modal fade" id="newMessageModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Nouveau message</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="newMessageForm">
            <div class="mb-3">
              <label>Destinataire</label>
              <select class="form-select" id="messageRecipient" required>
                <option value="">S√©lectionner</option>
              </select>
            </div>
            <div class="mb-3">
              <label>Message</label>
              <textarea class="form-control" id="messageContent" rows="4" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Envoyer</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Cr√©er/Modifier Classe -->
  <div class="modal fade" id="classModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="classModalTitle"><i class="bi bi-building me-2"></i>Cr√©er une classe</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="classForm">
            <div class="mb-3">
              <label for="className" class="form-label">Nom de la classe (ex: N1A, P2B)</label>
              <input type="text" class="form-control" id="className" placeholder="N1A" required>
            </div>
            <div class="mb-3">
              <label for="classLevel" class="form-label">Niveau</label>
              <select class="form-select" id="classLevel" required>
                <option value="">-- S√©lectionner un niveau --</option>
                <option value="N1">Nurserie 1</option>
                <option value="N2">Nurserie 2</option>
                <option value="N3">Nurserie 3</option>
                <option value="P1">Primaire 1</option>
                <option value="P2">Primaire 2</option>
                <option value="P3">Primaire 3</option>
                <option value="P4">Primaire 4</option>
                <option value="P5">Primaire 5</option>
                <option value="P6">Primaire 6</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="classCapacity" class="form-label">Capacit√© (nombre d'√©l√®ves)</label>
              <input type="number" class="form-control" id="classCapacity" value="30" required>
            </div>
            <input type="hidden" id="classId">
            <button type="submit" class="btn btn-primary">Enregistrer</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Param√®tres -->
  <div class="modal fade" id="settingsModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Param√®tres du compte</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="profileForm">
            <div class="mb-3">
              <label>Nom d'affichage</label>
              <input type="text" class="form-control" id="profileName">
            </div>
            <div class="mb-3">
              <label>Email</label>
              <input type="email" class="form-control" id="profileEmail" readonly>
            </div>
            <div class="mb-3">
              <label>Photo de profil (URL)</label>
              <input type="url" class="form-control" id="profilePhoto">
            </div>
            <button type="submit" class="btn btn-primary">Mettre √† jour</button>
          </form>
          <hr>
          <button class="btn btn-danger" onclick="logout()">D√©connexion</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for User Management -->
  <div class="modal fade" id="userModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="userModalTitle">Nouvel Utilisateur</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="userForm">
            <div class="mb-3">
              <label for="userName" class="form-label">Nom d'utilisateur</label>
              <input type="text" class="form-control" id="userName" required>
            </div>
            <div class="mb-3">
              <label for="userEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="userEmail" required>
            </div>
            <div class="mb-3">
              <label for="userPassword" class="form-label" id="userPasswordLabel">Mot de passe</label>
              <input type="password" class="form-control" id="userPassword">
              <small class="form-text text-muted">Minimum 6 caract√®res</small>
            </div>
            <div class="mb-3">
              <label for="userRole" class="form-label">R√¥le</label>
              <select class="form-select" id="userRole" required>
                <option value="">S√©lectionner un r√¥le</option>
                <option value="director">Directeur</option>
                <option value="accountant">Comptable</option>
                <option value="secretary">Secr√©taire</option>
                <option value="teacher">Enseignant</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="userStatus" class="form-label">Statut</label>
              <select class="form-select" id="userStatus" required>
                <option value="active">Actif</option>
                <option value="inactive">Inactif</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" id="deleteUserBtn" style="display:none;" onclick="deleteUserPrompt(currentUserId)">Supprimer</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" onclick="saveUser()">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyApUFNELOfgIe7rWEek9GLS9EIphNW09-A",
      authDomain: "edensmart-app.firebaseapp.com",
      projectId: "edensmart-app",
      storageBucket: "edensmart-app.firebasestorage.app",
      messagingSenderId: "1093120876724",
      appId: "1:1093120876724:web:bc37448cadd18d651c77e1",
      measurementId: "G-1FL70PZZSW"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    const storage = firebase.storage();

    // Variables globales
    let currentUser = null;
    let studentsData = [];
    let teachersData = [];
    let assignmentsData = [];
    let testsData = [];
    let examsData = [];
    let vacationWorksData = [];
    let booksData = [];
    let inscriptionsData = [];
    let messagesData = [];
    let activitiesData = [];
    let usersData = [];
    let filteredUsers = [];
    var currentUserId = null;
    let filteredStudents = [];
    let filteredTeachers = [];
    let filteredBooks = [];
    let classesData = [];
    let selectedClassName = null;

    let currentLang = 'fr';

    auth.onAuthStateChanged((user) => {
      if (user) {
        currentUser = user;
        document.getElementById('currentUser').textContent = user.email || 'Secr√©taire';
        loadAllData();
        loadMessages();
        loadActivities();
        loadUsers();
      renderUsers();
      } else {
        window.location.href = 'Auth.html';
      }
    });

    // Chargement des donn√©es
    function loadAllData() {
      loadStudents();
      loadTeachers();
      loadAssignments();
      loadTests();
      loadExams();
      loadVacationWorks();
      loadBooks();
      loadInscriptions();
      loadClasses();
    }

    function loadStudents() {
      database.ref('students').on('value', (snapshot) => {
        studentsData = [];
        snapshot.forEach(child => {
          studentsData.push({ id: child.key, ...child.val() });
        });
        filteredStudents = [...studentsData];
        document.getElementById('statsStudents').innerText = studentsData.length;
        document.getElementById('homeStatsStudents').innerText = studentsData.length;
        populateClassFilter();
        renderStudents();
        populateTeacherSelects();
        populateStudentSelects();
      });
    }

    function loadTeachers() {
      database.ref('teachers').on('value', (snapshot) => {
        teachersData = [];
        snapshot.forEach(child => {
          teachersData.push({ id: child.key, ...child.val() });
        });
        filteredTeachers = [...teachersData];
        const statsTeachersEl = document.getElementById('statsTeachers');
        if (statsTeachersEl) statsTeachersEl.innerText = teachersData.length;
        document.getElementById('homeStatsTeachers').innerText = teachersData.length;
        renderTeachers();
        populateTeacherSelects();
        populateTeacherSelectForReports();
      });
    }

    function loadAssignments() {
      database.ref('assignments').on('value', (snapshot) => {
        assignmentsData = [];
        snapshot.forEach(child => {
          assignmentsData.push({ id: child.key, ...child.val() });
        });
        document.getElementById('statsAssignments').innerText = assignmentsData.length;
        document.getElementById('homeStatsAssignments').innerText = assignmentsData.length;
        renderAssignments();
      });
    }

    function loadTests() {
      database.ref('tests').on('value', (snapshot) => {
        testsData = [];
        snapshot.forEach(child => {
          testsData.push({ id: child.key, ...child.val() });
        });
        renderTests();
      });
    }

    function loadExams() {
      database.ref('exams').on('value', (snapshot) => {
        examsData = [];
        snapshot.forEach(child => {
          examsData.push({ id: child.key, ...child.val() });
        });
        renderExams();
      });
    }

    function loadVacationWorks() {
      database.ref('vacationWorks').on('value', (snapshot) => {
        vacationWorksData = [];
        snapshot.forEach(child => {
          vacationWorksData.push({ id: child.key, ...child.val() });
        });
        renderVacationWorks();
      });
    }

    function loadBooks() {
      database.ref('books').on('value', (snapshot) => {
        booksData = [];
        snapshot.forEach(child => {
          booksData.push({ id: child.key, ...child.val() });
        });
        filteredBooks = [...booksData];
        document.getElementById('statsBooks').innerText = booksData.length;
        document.getElementById('homeStatsBooks').innerText = booksData.length;
        renderBooks();
      });
    }

    function loadInscriptions() {
      database.ref('inscriptions-scolaires').on('value', (snapshot) => {
        inscriptionsData = [];
        snapshot.forEach(child => {
          inscriptionsData.push({ id: child.key, ...child.val() });
        });
        document.getElementById('statsInscriptions').innerText = inscriptionsData.length;
        document.getElementById('homeStatsInscriptions').innerText = inscriptionsData.length;
      });
    }

    function loadMessages() {
      database.ref('messages').orderByChild('timestamp').on('value', (snapshot) => {
        messagesData = [];
        snapshot.forEach(child => {
          messagesData.push({ id: child.key, ...child.val() });
        });
        const unread = messagesData.filter(m => !m.read && m.receiverId === currentUser?.uid).length;
        document.getElementById('homeStatsMessages').innerText = unread;
        renderConversations();
      });
    }

    function loadActivities() {
      database.ref('activities').orderByChild('timestamp').limitToLast(20).on('value', (snapshot) => {
        activitiesData = [];
        snapshot.forEach(child => {
          activitiesData.push({ id: child.key, ...child.val() });
        });
        renderActivities();
      });
    }

    function loadUsers() {
      database.ref('users').on('value', (snapshot) => {
        usersData = [];
        snapshot.forEach(child => {
          usersData.push({ id: child.key, ...child.val() });
        });
        populateRecipientSelect();
        filteredUsers = [...usersData];
        renderUsers();
      });
    }

    function filterUsers() {
      const searchTerm = document.getElementById('searchUser')?.value.toLowerCase() || '';
      filteredUsers = usersData.filter(user => {
        return (
          (user.name && user.name.toLowerCase().includes(searchTerm)) ||
          (user.email && user.email.toLowerCase().includes(searchTerm)) ||
          (user.role && user.role.toLowerCase().includes(searchTerm))
        );
      });
      renderUsers();
    }

    function renderUsers() {
      const tbody = document.getElementById('usersTable');
      if (!tbody) return;
      
      if (filteredUsers.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" class="text-center text-muted py-5">
              <i class="bi bi-inbox" style="font-size: 2rem; opacity: 0.3;"></i>
              <p class="mt-2">Aucun utilisateur trouv\u00e9</p>
            </td>
          </tr>`;
        return;
      }
      
      let html = '';
      filteredUsers.forEach(user => {
        const roleColors = {
          'director': 'bg-danger',
          'directeur': 'bg-danger',
          'accountant': 'bg-warning',
          'comptable': 'bg-warning',
          'secretary': 'bg-info',
          'secr\u00e9taire': 'bg-info',
          'teacher': 'bg-success',
          'enseignant': 'bg-success'
        };
        const roleBg = roleColors[user.role?.toLowerCase()] || 'bg-secondary';
        const dateCreated = user.dateCreated ? new Date(user.dateCreated).toLocaleDateString('fr-FR') : 'N/A';
        const status = user.status === 'active' ? 'Actif' : 'Inactif';
        const statusColor = user.status === 'active' ? 'text-success' : 'text-danger';
        
        html += `
          <tr>
            <td><strong>${user.name || 'Non assign\u00e9'}</strong></td>
            <td>${user.email || 'N/A'}</td>
            <td><span class="badge ${roleBg}">${user.role || 'Aucun'}</span></td>
            <td><span class="${statusColor}">‚óè</span> ${status}</td>
            <td><small>${dateCreated}</small></td>
            <td>
              <button class="btn btn-sm btn-outline-primary" onclick="editUser('${user.id}')" title="Modifier">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteUserPrompt('${user.id}')" title="Supprimer">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>`;
      });
      tbody.innerHTML = html;
    }

    function openAddUserModal() {
      currentUserId = null;
      document.getElementById('userForm').reset();
      document.getElementById('userModalTitle').textContent = 'Nouvel Utilisateur';
      document.getElementById('userPassword').style.display = 'block';
      document.getElementById('userPasswordLabel').textContent = 'Mot de passe *';
      document.getElementById('deleteUserBtn').style.display = 'none';
      const modal = new bootstrap.Modal(document.getElementById('userModal'));
      modal.show();
    }

    function editUser(id) {
      const user = usersData.find(u => u.id === id);
      if (!user) return;
      
      currentUserId = id;
      document.getElementById('userModalTitle').textContent = '√âditer Utilisateur';
      document.getElementById('userName').value = user.name || '';
      document.getElementById('userEmail').value = user.email || '';
      document.getElementById('userRole').value = user.role || '';
      document.getElementById('userStatus').value = user.status || 'active';
      document.getElementById('userPassword').value = '';
      document.getElementById('userPassword').style.display = 'none';
      document.getElementById('userPasswordLabel').textContent = 'Nouveau mot de passe (laisser vide pour ne pas changer)';
      document.getElementById('deleteUserBtn').style.display = 'inline-block';
      
      const modal = new bootstrap.Modal(document.getElementById('userModal'));
      modal.show();
    }

    async function saveUser() {
      const form = document.getElementById('userForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const userData = {
        name: document.getElementById('userName').value,
        email: document.getElementById('userEmail').value,
        role: document.getElementById('userRole').value,
        status: document.getElementById('userStatus').value,
        updatedAt: new Date().toISOString()
      };

      try {
        if (currentUserId) {
          if (document.getElementById('userPassword').value) {
            userData.password = document.getElementById('userPassword').value;
          }
          await database.ref('users/' + currentUserId).update(userData);
          alert('Utilisateur mis \u00e0 jour avec succ\u00e8s!');
        } else {
          if (!document.getElementById('userPassword').value) {
            alert('Le mot de passe est requis pour un nouvel utilisateur!');
            return;
          }
          userData.password = document.getElementById('userPassword').value;
          userData.dateCreated = new Date().toISOString();
          await database.ref('users').push(userData);
          alert('Utilisateur cr\u00e9\u00e9 avec succ\u00e8s!');
        }
        
        bootstrap.Modal.getInstance(document.getElementById('userModal')).hide();
        loadUsers();
      } catch (error) {
        console.error('Erreur sauvegarde utilisateur:', error);
        alert('Erreur: ' + error.message);
      }
    }

    function deleteUserPrompt(id) {
      if (!confirm('√ätes-vous s\u00fbr de vouloir supprimer cet utilisateur?')) return;
      deleteUser(id);
    }

    async function deleteUser(id) {
      try {
        await database.ref('users/' + id).remove();
        alert('Utilisateur supprim\u00e9 avec succ\u00e8s!');
        loadUsers();
      } catch (error) {
        console.error('Erreur suppression utilisateur:', error);
        alert('Erreur: ' + error.message);
      }
    }

    // Fonctions d'affichage
    function renderStudents() {
      const tbody = document.getElementById('studentsTable');
      if (!tbody) return;
      if (filteredStudents.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7" class="text-center">Aucun √©l√®ve</td></tr>`;
        return;
      }
      let html = '';
      filteredStudents.forEach(s => {
        const teacher = teachersData.find(t => t.id === s.teacherId) || { name: 'Non assign√©' };
        html += `<tr>
          <td>${s.name || ''}</td>
          <td>${s.class || ''}</td>
          <td>${s.gender || ''}</td>
          <td>${s.parent || ''}</td>
          <td>${s.phone || ''}</td>
          <td>${s.dateAdded ? new Date(s.dateAdded).toLocaleDateString() : ''}</td>
          <td>
            <button class="btn btn-sm btn-outline-info" onclick="viewStudentProfile('${s.id}')"><i class="bi bi-eye"></i></button>
            <button class="btn btn-sm btn-outline-primary" onclick="editStudent('${s.id}')"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteStudent('${s.id}')"><i class="bi bi-trash"></i></button>
          </td>
        </tr>`;
      });
      tbody.innerHTML = html;
    }

    function renderTeachers() {
      const tbody = document.getElementById('teachersTable');
      if (!tbody) return;
      if (filteredTeachers.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7" class="text-center">Aucun enseignant</td></tr>`;
        return;
      }
      let html = '';
      filteredTeachers.forEach(t => {
        const studentCount = studentsData.filter(s => s.teacherId === t.id).length;
        html += `<tr>
          <td>${t.name || ''}</td>
          <td>${t.email || ''}</td>
          <td>${t.phone || ''}</td>
          <td>${t.subject || ''} (${t.classes || ''})</td>
          <td>${studentCount}</td>
          <td><span class="badge ${t.status === 'Actif' ? 'bg-success' : 'bg-secondary'}">${t.status || 'Inactif'}</span></td>
          <td>
            <button class="btn btn-sm btn-outline-info" onclick="viewTeacherProfile('${t.id}')"><i class="bi bi-eye"></i></button>
            <button class="btn btn-sm btn-outline-primary" onclick="editTeacher('${t.id}')"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteTeacher('${t.id}')"><i class="bi bi-trash"></i></button>
          </td>
        </tr>`;
      });
      tbody.innerHTML = html;
    }

    function renderAssignments() {
      const container = document.getElementById('assignmentsList');
      if (!container) return;
      if (assignmentsData.length === 0) {
        container.innerHTML = '<p class="text-muted">Aucun devoir.</p>';
        return;
      }
      let html = '';
      assignmentsData.forEach(a => {
        html += `<div class="card mb-2">
          <div class="card-body">
            <h6>${a.title}</h6>
            <p>${a.description || ''}</p>
            <p><small>Classe: ${a.class} | Mati√®re: ${a.subject} | Remise: ${a.dueDate ? new Date(a.dueDate).toLocaleString() : ''}</small></p>
            ${a.fileUrl ? `<a href="${a.fileUrl}" target="_blank" class="btn btn-sm btn-outline-info">Voir le fichier</a>` : ''}
          </div>
        </div>`;
      });
      container.innerHTML = html;
    }

    function renderTests() {
      const container = document.getElementById('testsList');
      if (!container) return;
      if (testsData.length === 0) {
        container.innerHTML = '<p class="text-muted">Aucun test.</p>';
        return;
      }
      let html = '';
      testsData.forEach(t => {
        html += `<div class="card mb-2">
          <div class="card-body">
            <h6>${t.title}</h6>
            <p>${t.description || ''}</p>
            <p><small>Classe: ${t.class} | Mati√®re: ${t.subject} | Date: ${t.date ? new Date(t.date).toLocaleString() : ''}</small></p>
          </div>
        </div>`;
      });
      container.innerHTML = html;
    }

    function renderExams() {
      const container = document.getElementById('examsList');
      if (!container) return;
      if (examsData.length === 0) {
        container.innerHTML = '<p class="text-muted">Aucun examen.</p>';
        return;
      }
      let html = '';
      examsData.forEach(e => {
        html += `<div class="card mb-2">
          <div class="card-body">
            <h6>${e.title}</h6>
            <p>${e.description || ''}</p>
            <p><small>Classe: ${e.class} | Mati√®re: ${e.subject} | Date: ${e.date ? new Date(e.date).toLocaleString() : ''}</small></p>
          </div>
        </div>`;
      });
      container.innerHTML = html;
    }

    function renderVacationWorks() {
      const container = document.getElementById('vacationList');
      if (!container) return;
      if (vacationWorksData.length === 0) {
        container.innerHTML = '<p class="text-muted">Aucun travail de vacances.</p>';
        return;
      }
      let html = '';
      vacationWorksData.forEach(v => {
        html += `<div class="card mb-2">
          <div class="card-body">
            <h6>${v.title}</h6>
            <p>${v.description || ''}</p>
            <p><small>Classe: ${v.class} | Mati√®re: ${v.subject} | P√©riode: ${v.period || ''}</small></p>
          </div>
        </div>`;
      });
      container.innerHTML = html;
    }

    function renderBooks() {
      const container = document.getElementById('libraryBooks');
      if (!container) return;
      if (filteredBooks.length === 0) {
        container.innerHTML = '<p class="text-muted">Aucun livre.</p>';
        return;
      }
      let html = '';
      filteredBooks.forEach(b => {
        html += `<div class="col-md-4">
          <div class="book-card">
            <img src="${b.coverUrl || 'https://via.placeholder.com/150'}" class="book-cover" alt="couverture">
            <h6>${b.title}</h6>
            <p>${b.author}</p>
            <p><small>${b.category || ''}</small></p>
            ${b.fileUrl ? `<a href="${b.fileUrl}" target="_blank" class="btn btn-sm btn-primary">Lire</a>` : ''}
          </div>
        </div>`;
      });
      container.innerHTML = html;
    }

    function renderActivities() {
      const container = document.getElementById('activitiesList');
      if (!container) return;
      if (activitiesData.length === 0) {
        container.innerHTML = '<p class="text-muted">Aucune activit√©.</p>';
        return;
      }
      let html = '<ul class="list-group">';
      activitiesData.forEach(a => {
        html += `<li class="list-group-item">${a.description} - ${new Date(a.timestamp).toLocaleString()}</li>`;
      });
      html += '</ul>';
      container.innerHTML = html;
    }

    function renderConversations() {
      const convList = document.getElementById('conversationsList');
      if (!convList) return;
      const userIds = new Set();
      messagesData.forEach(m => {
        if (m.senderId === currentUser?.uid) userIds.add(m.receiverId);
        if (m.receiverId === currentUser?.uid) userIds.add(m.senderId);
      });
      let html = '';
      userIds.forEach(uid => {
        const user = usersData.find(u => u.id === uid) || { email: uid };
        html += `<a href="#" class="list-group-item list-group-item-action" onclick="loadConversation('${uid}')">${user.email}</a>`;
      });
      convList.innerHTML = html || '<div class="list-group-item">Aucune conversation</div>';
    }

    function loadConversation(otherUserId) {
      const thread = document.getElementById('messageThread');
      const filtered = messagesData.filter(m => 
        (m.senderId === currentUser?.uid && m.receiverId === otherUserId) ||
        (m.senderId === otherUserId && m.receiverId === currentUser?.uid)
      ).sort((a,b) => a.timestamp - b.timestamp);
      let html = '';
      filtered.forEach(m => {
        const align = m.senderId === currentUser?.uid ? 'right' : 'left';
        html += `<div style="text-align:${align}; margin:5px; padding:5px; background:#f0f0f0; border-radius:5px;">${m.content}</div>`;
      });
      thread.innerHTML = html || 'Aucun message';
      document.getElementById('newMessageText').dataset.recipient = otherUserId;
    }

    function sendMessage() {
      const recipientId = document.getElementById('newMessageText').dataset.recipient;
      const content = document.getElementById('newMessageText').value;
      if (!recipientId || !content) return;
      const msg = {
        senderId: currentUser.uid,
        receiverId: recipientId,
        content: content,
        timestamp: Date.now(),
        read: false
      };
      database.ref('messages').push(msg).then(() => {
        document.getElementById('newMessageText').value = '';
        showNotification('Message envoy√©', 'success');
      });
    }

    function populateRecipientSelect() {
      const select = document.getElementById('messageRecipient');
      if (!select) return;
      let html = '<option value="">S√©lectionner</option>';
      usersData.filter(u => u.id !== currentUser?.uid).forEach(u => {
        html += `<option value="${u.id}">${u.email || u.id}</option>`;
      });
      select.innerHTML = html;
    }

    function openNewMessageModal() {
      const modal = new bootstrap.Modal(document.getElementById('newMessageModal'));
      modal.show();
    }

    document.getElementById('newMessageForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const recipient = document.getElementById('messageRecipient').value;
      const content = document.getElementById('messageContent').value;
      if (!recipient || !content) return;
      const msg = {
        senderId: currentUser.uid,
        receiverId: recipient,
        content: content,
        timestamp: Date.now(),
        read: false
      };
      database.ref('messages').push(msg).then(() => {
        bootstrap.Modal.getInstance(document.getElementById('newMessageModal')).hide();
        showNotification('Message envoy√©', 'success');
      });
    });

    // Fonctions pour les profils
    function viewStudentProfile(id) {
      const student = studentsData.find(s => s.id === id);
      if (!student) return;
      // Afficher une modal simple
      alert(JSON.stringify(student, null, 2));
    }

    function viewTeacherProfile(id) {
      const teacher = teachersData.find(t => t.id === id);
      alert(JSON.stringify(teacher, null, 2));
    }

    // Gestion des enseignants (lier aux √©l√®ves)
    function populateTeacherSelects() {
      const selectStudentTeacher = document.getElementById('studentTeacher');
      if (selectStudentTeacher) {
        let options = '<option value="">Aucun</option>';
        teachersData.filter(t => t.status === 'Actif').forEach(t => {
          options += `<option value="${t.id}">${t.name}</option>`;
        });
        selectStudentTeacher.innerHTML = options;
      }
    }

    function populateTeacherSelectForReports() {
      const select = document.getElementById('reportTeacherSelect');
      if (!select) return;
      let options = '<option value="">Choisir un enseignant</option>';
      teachersData.filter(t => t.status === 'Actif').forEach(t => {
        options += `<option value="${t.id}">${t.name}</option>`;
      });
      select.innerHTML = options;
    }

    function populateStudentSelects() {
      const select = document.getElementById('reportStudentSelect');
      if (!select) return;
      let options = '<option value="">Choisir un √©l√®ve</option>';
      studentsData.forEach(s => {
        options += `<option value="${s.id}">${s.name} (${s.class})</option>`;
      });
      select.innerHTML = options;
    }

    function loadTeachersForClass() {
      const className = document.getElementById('reportClassSelect').value;
      const select = document.getElementById('reportTeacherSelect');
      if (!select) return;
      let options = '<option value="">Choisir un enseignant</option>';
      if (!className) {
        teachersData.filter(t => t.status === 'Actif').forEach(t => {
          options += `<option value="${t.id}">${t.name}</option>`;
        });
      } else {
        teachersData.filter(t => {
          if (!t.classes) return false;
          const cls = (Array.isArray(t.classes) ? t.classes : (''+t.classes)).split(',').map(x=>x.trim());
          return cls.includes(className);
        }).forEach(t => {
          options += `<option value="${t.id}">${t.name}</option>`;
        });
      }
      select.innerHTML = options;
    }

    // Classes management
    function loadClasses() {
      database.ref('classes').on('value', (snapshot) => {
        classesData = [];
        snapshot.forEach(child => classesData.push({ id: child.key, ...child.val() }));
        populateTeacherClassesSelect();
        populateReportClassSelect();
        populateClassesList();
      });
      // fallback: if no classes defined, derive from students
      database.ref('classes').once('value').then(snap => {
        if (!snap.exists()) {
          const derived = [...new Set(studentsData.map(s => s.class).filter(c => !!c))];
          classesData = derived.map(c => ({ id: c, name: c }));
          populateTeacherClassesSelect();
          populateReportClassSelect();
          populateClassesList();
        }
      });
    }

    function populateTeacherClassesSelect() {
      const select = document.getElementById('teacherClasses');
      if (!select) return;
      let options = '';
      classesData.sort((a,b)=> (a.name||'').localeCompare(b.name||'')).forEach(c => {
        options += `<option value="${c.name}">${c.name} ${c.level?(' - '+c.level):''}</option>`;
      });
      select.innerHTML = options;
    }

    function populateReportClassSelect() {
      const select = document.getElementById('reportClassSelect');
      if (!select) return;
      let options = '<option value="">Choisir une classe</option>';
      classesData.sort((a,b)=> (a.name||'').localeCompare(b.name||'')).forEach(c => {
        options += `<option value="${c.name}">${c.name}</option>`;
      });
      // fallback to class filter from students if no classes
      if (classesData.length === 0) {
        const derived = [...new Set(studentsData.map(s=>s.class).filter(c=>!!c))].sort();
        derived.forEach(c => options += `<option value="${c}">${c}</option>`);
      }
      select.innerHTML = options;
    }

    function populateClassesList() {
      const container = document.getElementById('classesList');
      if (!container) return;
      if (!classesData || classesData.length === 0) {
        container.innerHTML = '<div class="text-muted">Aucune classe d√©finie</div>';
        return;
      }
      let html = '';
      classesData.forEach(c => {
        html += `<div class="d-flex justify-content-between align-items-center mb-2">
          <div><strong>${c.name}</strong> <small class="text-muted">${c.level||''}</small></div>
          <div>
            <button class="btn btn-sm btn-outline-primary me-1" onclick="selectClassForView('${c.name}')">Voir</button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteClass('${c.id}')">Supprimer</button>
          </div>
        </div>`;
      });
      container.innerHTML = html;
    }

    function openAddClassModal() {
      document.getElementById('classForm').reset();
      document.getElementById('classId').value = '';
      document.getElementById('classModalTitle').textContent = 'Cr√©er une classe';
      const modal = new bootstrap.Modal(document.getElementById('classModal'));
      modal.show();
    }

    document.getElementById('classForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const id = document.getElementById('classId').value;
      const data = {
        name: document.getElementById('className').value.trim(),
        level: document.getElementById('classLevel').value,
        capacity: Number(document.getElementById('classCapacity').value) || 0,
        updatedAt: new Date().toISOString()
      };
      if (id) {
        database.ref('classes/' + id).update(data);
      } else {
        data.dateCreated = new Date().toISOString();
        database.ref('classes').push(data);
      }
      bootstrap.Modal.getInstance(document.getElementById('classModal')).hide();
      showNotification('Classe enregistr√©e', 'success');
    });

    function selectClassForView(name) {
      selectedClassName = name;
      document.getElementById('selectedClassName').textContent = name;
      loadStudentsForClass(name);
    }

    function deleteClass(id) {
      if (!confirm('Supprimer cette classe ?')) return;
      database.ref('classes/' + id).remove();
    }

    function loadStudentsForClass(className) {
      const container = document.getElementById('classStudentsList');
      if (!container) return;
      const students = studentsData.filter(s => s.class === className);
      if (students.length === 0) {
        container.innerHTML = '<div class="text-muted">Aucun √©l√®ve dans cette classe</div>';
        return;
      }
      let html = '<ul class="list-group">';
      students.forEach(s => html += `<li class="list-group-item">${s.name} <small class="text-muted">(${s.parent || ''})</small></li>`);
      html += '</ul>';
      container.innerHTML = html;
    }

    function loadStudentsForTeacher() {
      const teacherId = document.getElementById('reportTeacherSelect').value;
      const select = document.getElementById('reportStudentSelect');
      if (!teacherId) {
        populateStudentSelects();
        return;
      }
      const students = studentsData.filter(s => s.teacherId === teacherId);
      let options = '<option value="">Choisir un √©l√®ve</option>';
      students.forEach(s => {
        options += `<option value="${s.id}">${s.name} (${s.class})</option>`;
      });
      select.innerHTML = options;
    }

    function loadReportsForStudent() {
      const studentId = document.getElementById('reportStudentSelect').value;
      const type = document.getElementById('reportTypeSelect').value;
      const container = document.getElementById('reportsList');
      if (!studentId) {
        container.innerHTML = '';
        return;
      }
      // Simuler la recherche de bulletins (√† impl√©menter avec Firebase Storage)
      // On suppose que les bulletins sont stock√©s dans un dossier "reports" avec le nom: studentId_type.pdf
      const storageRef = storage.ref('reports');
      storageRef.child(`${studentId}_${type}.pdf`).getDownloadURL().then(url => {
        container.innerHTML = `<div class="col-12">
          <p>Bulletin disponible : <a href="${url}" target="_blank" class="btn btn-sm btn-primary">T√©l√©charger</a></p>
        </div>`;
      }).catch(() => {
        container.innerHTML = `<div class="col-12"><p class="text-warning">Aucun bulletin trouv√© pour cet √©l√®ve.</p></div>`;
      });
    }

    function sendMissingReportAlert() {
      const studentId = document.getElementById('reportStudentSelect').value;
      const student = studentsData.find(s => s.id === studentId);
      if (!student || !student.teacherId) {
        showNotification('Aucun enseignant associ√©', 'warning');
        return;
      }
      const teacher = teachersData.find(t => t.id === student.teacherId);
      if (!teacher) return;
      const msg = {
        senderId: currentUser.uid,
        receiverId: teacher.id, // √† condition que teacher ait un compte user
        content: `Bulletin manquant pour l'√©l√®ve ${student.name}`,
        timestamp: Date.now(),
        read: false
      };
      database.ref('messages').push(msg).then(() => {
        showNotification('Alerte envoy√©e √† l\'enseignant', 'success');
      });
    }

    // Soumission inscription + cr√©ation √©l√®ve
    async function submitSecretaryInscription() {
      // Validation simplifi√©e
      const form = document.getElementById('inscriptionFormSecretary');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const formData = {
        nomPrenom: document.getElementById('nomPrenomSec').value,
        dateNaissance: document.getElementById('dateNaissanceSec').value,
        ecoleProvenance: document.getElementById('ecoleProvenanceSec').value,
        sexe: document.querySelector('input[name="sexe"]:checked')?.value,
        section: document.querySelector('input[name="section"]:checked')?.value,
        niveau: document.querySelector('input[name="section"]:checked')?.value === 'MATERNELLE' ? document.getElementById('niveauMaternelleSec').value : document.getElementById('niveauPrimaireSec').value,
        sdmsCode: document.getElementById('sdmsCodeSec').value || null,
        branche: document.querySelector('input[name="branche"]:checked')?.value,
        transport: document.querySelector('input[name="transport"]:checked')?.value,
        chefNomPrenom: document.getElementById('chefNomPrenomSec').value,
        chefTelephone: document.getElementById('chefTelephoneSec').value,
        chefPieceIdentite: document.getElementById('chefPieceIdentiteSec').value,
        conjointNomPrenom: document.getElementById('conjointNomPrenomSec').value || null,
        conjointTelephone: document.getElementById('conjointTelephoneSec').value || null,
        conjointPieceIdentite: document.getElementById('conjointPieceIdentiteSec').value || null,
        ville: document.getElementById('villeSec').value,
        secteur: document.getElementById('secteurSec').value,
        umurenge: document.getElementById('umurengeSec').value,
        akagari: document.getElementById('akagariSec').value,
        umudugudu: document.getElementById('umuduguduSec').value,
        codeUnique: generateStudentCodeSec(),
        dateInscription: new Date().toISOString(),
        timestamp: Date.now(),
        statut: 'En attente de validation'
      };

      try {
        await database.ref('inscriptions-scolaires').push(formData);

        const studentData = {
          name: formData.nomPrenom,
          class: formData.niveau,
          gender: formData.sexe === 'GAR√áON' ? 'Masculin' : 'F√©minin',
          dob: formData.dateNaissance,
          parent: formData.chefNomPrenom,
          phone: formData.chefTelephone,
          parentEmail: '',
          address: `${formData.ville}, ${formData.secteur}, ${formData.umurenge}, ${formData.akagari}, ${formData.umudugudu}`,
          dateAdded: new Date().toISOString(),
          status: 'Actif',
          teacherId: null
        };
        await database.ref('students').push(studentData);

        showNotification(`Inscription enregistr√©e et √©l√®ve cr√©√©! Code: ${formData.codeUnique}`, 'success');
        document.getElementById('inscriptionFormSecretary').reset();
      } catch (error) {
        showNotification('Erreur: ' + error.message, 'danger');
      }
    }

    function generateStudentCodeSec() {
      return 'INS-' + Date.now();
    }

    // Upload de fichier pour les devoirs
    document.getElementById('assignmentForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const file = document.getElementById('assignmentFile').files[0];
      let fileUrl = document.getElementById('assignmentFileUrl').value;

      if (file) {
        const storageRef = storage.ref('assignments/' + Date.now() + '_' + file.name);
        await storageRef.put(file);
        fileUrl = await storageRef.getDownloadURL();
      }

      const data = {
        title: document.getElementById('assignmentTitle').value,
        class: document.getElementById('assignmentClass').value,
        subject: document.getElementById('assignmentSubject').value,
        description: document.getElementById('assignmentDesc').value,
        dueDate: document.getElementById('assignmentDueDate').value,
        fileUrl: fileUrl,
        updatedAt: new Date().toISOString()
      };

      const id = document.getElementById('assignmentId').value;
      if (id) {
        await database.ref('assignments/' + id).update(data);
      } else {
        data.dateAdded = new Date().toISOString();
        data.createdBy = currentUser.email;
        await database.ref('assignments').push(data);
      }
      bootstrap.Modal.getInstance(document.getElementById('assignmentModal')).hide();
      showNotification('Devoir enregistr√©', 'success');
    });

    // Upload pour les livres
    document.getElementById('bookForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const file = document.getElementById('bookFile').files[0];
      const coverFile = document.getElementById('bookCoverFile').files[0];
      let fileUrl = '';
      let coverUrl = '';

      if (file) {
        const storageRef = storage.ref('books/' + Date.now() + '_' + file.name);
        await storageRef.put(file);
        fileUrl = await storageRef.getDownloadURL();
      }
      if (coverFile) {
        const coverRef = storage.ref('covers/' + Date.now() + '_' + coverFile.name);
        await coverRef.put(coverFile);
        coverUrl = await coverRef.getDownloadURL();
      }

      const data = {
        title: document.getElementById('bookTitle').value,
        author: document.getElementById('bookAuthor').value,
        category: document.getElementById('bookCategory').value,
        class: document.getElementById('bookClass').value,
        description: document.getElementById('bookDescription').value,
        fileUrl: fileUrl,
        coverUrl: coverUrl,
        type: 'text',
        updatedAt: new Date().toISOString()
      };

      const id = document.getElementById('bookId').value;
      if (id) {
        await database.ref('books/' + id).update(data);
      } else {
        data.dateAdded = new Date().toISOString();
        data.createdBy = currentUser.email;
        await database.ref('books').push(data);
      }
      bootstrap.Modal.getInstance(document.getElementById('bookModal')).hide();
      showNotification('Livre enregistr√©', 'success');
    });

    // Upload pour livres audio
    document.getElementById('audioBookForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const file = document.getElementById('audioBookFile').files[0];
      const coverFile = document.getElementById('audioBookCoverFile').files[0];
      let fileUrl = '';
      let coverUrl = '';

      if (file) {
        const storageRef = storage.ref('audiobooks/' + Date.now() + '_' + file.name);
        await storageRef.put(file);
        fileUrl = await storageRef.getDownloadURL();
      }
      if (coverFile) {
        const coverRef = storage.ref('covers/' + Date.now() + '_' + coverFile.name);
        await coverRef.put(coverFile);
        coverUrl = await coverRef.getDownloadURL();
      }

      const data = {
        title: document.getElementById('audioBookTitle').value,
        author: document.getElementById('audioBookAuthor').value,
        category: document.getElementById('audioBookCategory').value,
        class: document.getElementById('audioBookClass').value,
        duration: document.getElementById('audioBookDuration').value,
        description: document.getElementById('audioBookDescription').value,
        fileUrl: fileUrl,
        coverUrl: coverUrl,
        type: 'audio',
        updatedAt: new Date().toISOString()
      };

      const id = document.getElementById('audioBookId').value;
      if (id) {
        await database.ref('books/' + id).update(data);
      } else {
        data.dateAdded = new Date().toISOString();
        data.createdBy = currentUser.email;
        await database.ref('books').push(data);
      }
      bootstrap.Modal.getInstance(document.getElementById('audioBookModal')).hide();
      showNotification('Livre audio enregistr√©', 'success');
    });

    // Fonctions de filtre
    function filterStudents() {
      const searchTerm = document.getElementById('searchStudent').value.toLowerCase();
      const classFilter = document.getElementById('classFilter').value;
      filteredStudents = studentsData.filter(s => {
        const matchSearch = (s.name && s.name.toLowerCase().includes(searchTerm)) ||
                           (s.parent && s.parent.toLowerCase().includes(searchTerm)) ||
                           (s.phone && s.phone.includes(searchTerm));
        if (!matchSearch) return false;
        if (classFilter && s.class !== classFilter) return false;
        return true;
      });
      renderStudents();
    }

    function filterTeachers() {
      const searchTerm = document.getElementById('searchTeacher').value.toLowerCase();
      filteredTeachers = teachersData.filter(t => {
        return (t.name && t.name.toLowerCase().includes(searchTerm)) ||
               (t.email && t.email.toLowerCase().includes(searchTerm)) ||
               (t.phone && t.phone.includes(searchTerm));
      });
      renderTeachers();
    }

    function filterBooks() {
      const searchTerm = document.getElementById('searchBook').value.toLowerCase();
      const filterType = document.getElementById('bookFilter').value;
      filteredBooks = booksData.filter(b => {
        const matchSearch = (b.title && b.title.toLowerCase().includes(searchTerm)) ||
                            (b.author && b.author.toLowerCase().includes(searchTerm));
        if (!matchSearch) return false;
        if (filterType === 'text' && b.type !== 'text') return false;
        if (filterType === 'audio' && b.type !== 'audio') return false;
        if (filterType === 'available' && b.status !== 'Disponible') return false;
        return true;
      });
      renderBooks();
    }

    function populateClassFilter() {
      const select = document.getElementById('classFilter');
      const classes = [...new Set(studentsData.map(s => s.class).filter(c => !!c))].sort();
      let options = '<option value="">Toutes les classes</option>';
      classes.forEach(c => options += `<option value="${c}">${c}</option>`);
      select.innerHTML = options;
    }

    // Ouverture des modals
    function openAddStudentModal() {
      document.getElementById('studentForm').reset();
      document.getElementById('studentId').value = '';
      const modal = new bootstrap.Modal(document.getElementById('studentModal'));
      modal.show();
    }

    function openAddTeacherModal() {
      document.getElementById('teacherForm').reset();
      document.getElementById('teacherId').value = '';
      const modal = new bootstrap.Modal(document.getElementById('teacherModal'));
      modal.show();
    }

    function openAddAssignmentModal() {
      document.getElementById('assignmentForm').reset();
      document.getElementById('assignmentId').value = '';
      document.getElementById('assignmentFileUrl').value = '';
      const modal = new bootstrap.Modal(document.getElementById('assignmentModal'));
      modal.show();
    }

    function openAddTestModal() { /* similaire */ }
    function openAddExamModal() { /* similaire */ }
    function openAddVacationWorkModal() { /* similaire */ }

    function openAddBookModal() {
      document.getElementById('bookForm').reset();
      document.getElementById('bookId').value = '';
      const modal = new bootstrap.Modal(document.getElementById('bookModal'));
      modal.show();
    }

    function openAddAudioBookModal() {
      document.getElementById('audioBookForm').reset();
      document.getElementById('audioBookId').value = '';
      const modal = new bootstrap.Modal(document.getElementById('audioBookModal'));
      modal.show();
    }

    function editStudent(id) {
      const student = studentsData.find(s => s.id === id);
      if (!student) return;
      document.getElementById('studentId').value = student.id;
      document.getElementById('studentName').value = student.name || '';
      document.getElementById('studentClass').value = student.class || '';
      document.getElementById('studentGender').value = student.gender || '';
      document.getElementById('studentDob').value = student.dob || '';
      document.getElementById('studentParent').value = student.parent || '';
      document.getElementById('studentPhone').value = student.phone || '';
      document.getElementById('studentEmail').value = student.parentEmail || '';
      document.getElementById('studentTeacher').value = student.teacherId || '';
      const modal = new bootstrap.Modal(document.getElementById('studentModal'));
      modal.show();
    }

    document.getElementById('studentForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const id = document.getElementById('studentId').value;
      const data = {
        name: document.getElementById('studentName').value,
        class: document.getElementById('studentClass').value,
        gender: document.getElementById('studentGender').value,
        dob: document.getElementById('studentDob').value,
        parent: document.getElementById('studentParent').value,
        phone: document.getElementById('studentPhone').value,
        parentEmail: document.getElementById('studentEmail').value,
        teacherId: document.getElementById('studentTeacher').value || null,
        updatedAt: new Date().toISOString()
      };
      if (id) {
        database.ref('students/' + id).update(data);
      } else {
        data.dateAdded = new Date().toISOString();
        database.ref('students').push(data);
      }
      bootstrap.Modal.getInstance(document.getElementById('studentModal')).hide();
      showNotification('√âl√®ve enregistr√©', 'success');
    });

    function editTeacher(id) {
      const teacher = teachersData.find(t => t.id === id);
      if (!teacher) return;
      document.getElementById('teacherId').value = teacher.id;
      document.getElementById('teacherName').value = teacher.name || '';
      document.getElementById('teacherEmail').value = teacher.email || '';
      document.getElementById('teacherPhone').value = teacher.phone || '';
      document.getElementById('teacherSubject').value = teacher.subject || '';
      // set multi-select values
      const select = document.getElementById('teacherClasses');
      if (select) {
        const vals = teacher.classes ? (Array.isArray(teacher.classes) ? teacher.classes : (''+teacher.classes).split(',').map(s=>s.trim())) : [];
        Array.from(select.options).forEach(opt => {
          opt.selected = vals.includes(opt.value);
        });
      }
      document.getElementById('teacherStatus').value = teacher.status || 'Actif';
      const modal = new bootstrap.Modal(document.getElementById('teacherModal'));
      modal.show();
    }

    document.getElementById('teacherForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const id = document.getElementById('teacherId').value;
      const selected = Array.from(document.getElementById('teacherClasses').selectedOptions).map(o => o.value).filter(Boolean);
      const classesValue = selected.join(',');
      const data = {
        name: document.getElementById('teacherName').value,
        email: document.getElementById('teacherEmail').value,
        phone: document.getElementById('teacherPhone').value,
        subject: document.getElementById('teacherSubject').value,
        classes: classesValue,
        status: document.getElementById('teacherStatus').value,
        updatedAt: new Date().toISOString()
      };
      if (id) {
        database.ref('teachers/' + id).update(data);
      } else {
        data.dateAdded = new Date().toISOString();
        database.ref('teachers').push(data);
      }
      // refresh depends on realtime listener
      bootstrap.Modal.getInstance(document.getElementById('teacherModal')).hide();
      showNotification('Enseignant enregistr√©', 'success');
    });

    function deleteStudent(id) {
      if (confirm('Supprimer cet √©l√®ve ?')) {
        database.ref('students/' + id).remove();
      }
    }

    function deleteTeacher(id) {
      if (confirm('Supprimer cet enseignant ?')) {
        database.ref('teachers/' + id).remove();
      }
    }

    // Navigation
    function switchSection(section) {
      document.querySelectorAll('.content-section').forEach(s => s.style.display = 'none');
      document.getElementById('section-' + section).style.display = 'block';
      document.querySelectorAll('.sidebar .list-group-item').forEach(item => item.classList.remove('active'));
      document.querySelector(`.sidebar .list-group-item[data-section="${section}"]`).classList.add('active');
    }

    function switchAcademic(type) {
      document.querySelectorAll('.academic-content').forEach(c => c.style.display = 'none');
      document.getElementById('academic-' + type).style.display = 'block';
      document.querySelectorAll('.academic-nav .list-group-item').forEach(item => item.classList.remove('active'));
      event.target.classList.add('active');
    }

    // Carrousel contacts
    let contactIndex = 0;
    const contacts = document.querySelectorAll('.contact-carousel-item');
    function showContact(index) {
      contacts.forEach((el, i) => el.classList.toggle('active', i === index));
    }
    function nextContact() {
      contactIndex = (contactIndex + 1) % contacts.length;
      showContact(contactIndex);
    }
    function prevContact() {
      contactIndex = (contactIndex - 1 + contacts.length) % contacts.length;
      showContact(contactIndex);
    }
    setInterval(nextContact, 5000);

    // Effet de lueur
    document.querySelectorAll('.glow-effect').forEach(icon => {
      icon.addEventListener('mousemove', (e) => {
        const rect = icon.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        icon.style.setProperty('--x', x + 'px');
        icon.style.setProperty('--y', y + 'px');
      });
    });

    // Param√®tres
    function openSettings() {
      const modal = new bootstrap.Modal(document.getElementById('settingsModal'));
      if (currentUser) {
        document.getElementById('profileEmail').value = currentUser.email;
        database.ref('users/' + currentUser.uid).once('value').then(snap => {
          const data = snap.val() || {};
          document.getElementById('profileName').value = data.displayName || '';
          document.getElementById('profilePhoto').value = data.photoURL || '';
        });
      }
      modal.show();
    }
    document.getElementById('profileForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const updates = {
        displayName: document.getElementById('profileName').value,
        photoURL: document.getElementById('profilePhoto').value,
      };
      database.ref('users/' + currentUser.uid).update(updates).then(() => {
        showNotification('Profil mis √† jour', 'success');
        bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
      });
    });

    function toggleLanguage() {
      currentLang = currentLang === 'fr' ? 'en' : 'fr';
      showNotification('Langue chang√©e en ' + (currentLang === 'fr' ? 'Fran√ßais' : 'Anglais'), 'info');
    }

    function logout() {
      if (confirm('D√©connexion ?')) {
        auth.signOut().then(() => window.location.href = 'Auth.html');
      }
    }

    function showNotification(message, type) {
      const notification = document.getElementById('notification');
      const title = document.getElementById('notification-title');
      const messageEl = document.getElementById('notification-message');
      notification.className = 'alert-notification alert alert-' + type;
      title.textContent = type === 'success' ? 'Succ√®s' : type === 'danger' ? 'Erreur' : 'Info';
      messageEl.textContent = message;
      notification.style.display = 'block';
      setTimeout(() => notification.classList.add('show'), 10);
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.style.display = 'none', 300);
      }, 5000);
    }

    function hideNotification() {
      document.getElementById('notification').style.display = 'none';
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
      showContact(0);
    });
  </script>
</body>
</html>